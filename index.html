<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Premium Drive - Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { user-select: none; -webkit-user-select: none; touch-action: none; overflow: hidden; background-color: #020617; font-family: sans-serif; }
        .hidden { display: none !important; }
        .glass-panel {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .neon-cyan { text-shadow: 0 0 10px #22d3ee; }
        canvas { touch-action: none; }
    </style>
</head>
<body class="text-white h-screen flex flex-col">

    <div id="loginScreen" class="fixed inset-0 z-50 flex items-center justify-center bg-[#020617] p-6">
        <div class="glass-panel p-10 rounded-[32px] w-full max-w-sm text-center">
            <h1 class="text-4xl font-black italic mb-2 neon-cyan">PREMIUM DRIVE</h1>
            <p class="text-slate-400 mb-8">Balans: <span id="loginBalanceText" class="text-cyan-400 font-bold">0.30 AZN</span></p>
            <button id="loginBtn" class="w-full py-4 bg-cyan-500 text-white rounded-2xl font-bold uppercase tracking-widest active:scale-95 transition-all">Oyuna Ba≈üla</button>
        </div>
    </div>

    <div id="gameScreen" class="hidden h-screen flex flex-col relative">
        <div class="p-4 flex justify-between items-center z-30">
            <div class="flex gap-2">
                <div class="glass-panel p-2 px-4 rounded-xl">
                    <p class="text-[10px] uppercase text-cyan-400">Balans</p>
                    <p id="balanceText" class="font-black">0.30 AZN</p>
                </div>
                <div class="glass-panel p-2 px-4 rounded-xl">
                    <p class="text-[10px] uppercase text-emerald-400">M…ôsaf…ô</p>
                    <p id="scoreText" class="font-black">0 M</p>
                </div>
            </div>
            <button id="garageBtn" class="w-12 h-12 glass-panel rounded-xl flex items-center justify-center text-xl">üõí</button>
        </div>

        <div class="px-4 z-30 mb-2">
            <div class="glass-panel rounded-xl p-2 text-[11px] flex items-center gap-2 italic text-blue-200">
                <span id="aiIcon">ü§ñ</span> <span id="aiTipText">Yola diqq…ôt yetir, s√ºr√ºc√º!</span>
            </div>
        </div>

        <div class="flex-1 w-full max-w-[400px] mx-auto relative overflow-hidden bg-[#0f172a] border-x border-white/10">
            <canvas id="gameCanvas"></canvas>
            <div class="absolute inset-0 flex">
                <div id="laneLeft" class="flex-1"></div>
                <div id="laneRight" class="flex-1"></div>
            </div>
            <div id="gameOverScreen" class="hidden absolute inset-0 bg-black/80 backdrop-blur-md flex flex-col items-center justify-center p-8 z-40 text-center">
                <h2 class="text-4xl font-black text-rose-500 mb-4">GAME OVER</h2>
                <button id="restartBtn" class="w-full py-4 bg-white text-black rounded-2xl font-bold uppercase">Yenid…ôn Ba≈üla</button>
            </div>
        </div>

        <div class="p-4 pb-8 z-30 max-w-[400px] w-full mx-auto">
            <button id="brakeBtn" class="w-full py-6 bg-rose-600 rounded-3xl text-2xl font-black active:bg-rose-700 active:scale-95 transition-all">TORMOZ</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // √ñl√ß√ºl…ôri nizamla
        function resize() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // Oyun D…ôyi≈ü…ônl…ôri
        const CAR_W = 45, CAR_H = 80;
        const LANES = [canvas.width * 0.25, canvas.width * 0.5, canvas.width * 0.75];
        let balance = 0.30;
        let score = 0;
        let isRunning = false;
        let isBraking = false;
        let player = { x: LANES[1], targetX: LANES[1], y: 0 };
        let traffic = [];
        let lineOffset = 0;
        let speed = 4;

        function updateUI() {
            const val = balance.toFixed(2) + " AZN";
            document.getElementById('balanceText').innerText = val;
            document.getElementById('loginBalanceText').innerText = val;
            document.getElementById('scoreText').innerText = Math.floor(score) + " M";
        }

        function spawnTraffic() {
            if (Math.random() < 0.015 && !isBraking) {
                const lane = LANES[Math.floor(Math.random() * LANES.length)];
                if (traffic.every(t => Math.abs(t.y) > 200)) {
                    traffic.push({ x: lane, y: -100, speed: 2 + Math.random() * 2 });
                }
            }
        }

        function update() {
            if (!isRunning) return;

            const curSpeed = isBraking ? 0 : speed;
            lineOffset = (lineOffset + curSpeed) % 60;
            score += curSpeed / 50;
            
            // Oyun√ßunu h…ôr…ôk…ôt etdir (Daha s√ºr…ôtli ke√ßid: 0.2)
            player.x += (player.targetX - player.x) * 0.2;
            player.y = canvas.height - 150;

            traffic.forEach((car, index) => {
                car.y += curSpeed + (isBraking ? car.speed : car.speed - 2);
                
                // Toqqu≈üma (Hitbox ki√ßikdir ki, oyun√ßu tez uduzmasƒ±n)
                if (Math.abs(player.x - car.x) < CAR_W * 0.7 && Math.abs(player.y - car.y) < CAR_H * 0.8) {
                    balance -= 0.10;
                    traffic.splice(index, 1);
                    if (balance <= 0) { balance = 0; isRunning = false; document.getElementById('gameOverScreen').classList.remove('hidden'); }
                    updateUI();
                }
                if (car.y > canvas.height) traffic.splice(index, 1);
            });

            spawnTraffic();
            if (speed < 8) speed += 0.0005;
        }

        function drawCar(x, y, color, isPlayer) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.roundRect(x - CAR_W/2, y - CAR_H/2, CAR_W, CAR_H, 10);
            ctx.fill();
            // ≈û√º≈ü…ô
            ctx.fillStyle = "rgba(0,0,0,0.3)";
            ctx.fillRect(x - CAR_W/2 + 5, y - CAR_H/2 + 15, CAR_W - 10, 20);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Yol cizgil…ôri
            ctx.strokeStyle = "rgba(255,255,255,0.2)";
            ctx.setLineDash([20, 40]);
            ctx.lineDashOffset = -lineOffset;
            ctx.lineWidth = 4;
            [canvas.width * 0.38, canvas.width * 0.62].forEach(lx => {
                ctx.beginPath(); ctx.moveTo(lx, 0); ctx.lineTo(lx, canvas.height); ctx.stroke();
            });

            traffic.forEach(t => drawCar(t.x, t.y, "#f43f5e", false));
            drawCar(player.x, player.y, "#0ea5e9", true);
        }

        function loop() {
            update();
            draw();
            if (isRunning) requestAnimationFrame(loop);
        }

        // ƒ∞dar…ôetm…ô
        document.getElementById('loginBtn').onclick = () => {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            isRunning = true;
            loop();
        };

        document.getElementById('restartBtn').onclick = () => {
            location.reload();
        };

        const goLeft = (e) => { e.preventDefault(); if (player.targetX > LANES[0]) player.targetX -= (LANES[1]-LANES[0]); };
        const goRight = (e) => { e.preventDefault(); if (player.targetX < LANES[2]) player.targetX += (LANES[1]-LANES[0]); };
        
        document.getElementById('laneLeft').ontouchstart = goLeft;
        document.getElementById('laneRight').ontouchstart = goRight;
        document.getElementById('laneLeft').onmousedown = goLeft;
        document.getElementById('laneRight').onmousedown = goRight;

        const setBrake = (val) => (e) => { e.preventDefault(); isBraking = val; };
        const bBtn = document.getElementById('brakeBtn');
        bBtn.ontouchstart = setBrake(true); bBtn.ontouchend = setBrake(false);
        bBtn.onmousedown = setBrake(true); bBtn.onmouseup = setBrake(false);

        updateUI();
    </script>
</body>
</html>
