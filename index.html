<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Premium Drive - Stabil</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            overflow: hidden; 
            background-color: #020617; 
            user-select: none; 
            -webkit-user-select: none;
            touch-action: none;
            font-family: 'Segoe UI', sans-serif;
        }
        canvas { 
            display: block; 
            background-color: #0f172a; 
            margin: 0 auto;
        }
        .ui-layer { position: absolute; inset: 0; pointer-events: none; }
        .interactive { pointer-events: auto; }
        .glass { 
            background: rgba(15, 23, 42, 0.8); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(255,255,255,0.1); 
        }
    </style>
</head>
<body>

    <div id="startScreen" class="fixed inset-0 z-50 flex items-center justify-center bg-[#020617]">
        <div class="text-center p-8 glass rounded-[40px] border border-cyan-500/30 w-[80%] max-w-sm">
            <h1 class="text-4xl font-black text-white italic mb-4 tracking-tighter">PREMIUM DRIVE</h1>
            <p class="text-cyan-400 font-bold mb-8">Balans: 0.30 AZN</p>
            <button id="startBtn" class="interactive w-full py-5 bg-cyan-500 text-white rounded-2xl font-black uppercase tracking-widest shadow-lg shadow-cyan-500/20 active:scale-95 transition-all">
                OYUNA BAŞLA
            </button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div class="ui-layer flex flex-col justify-between p-4">
        <div class="flex justify-between items-start">
            <div class="glass p-3 rounded-2xl">
                <p class="text-[10px] text-cyan-400 font-bold uppercase">Balans</p>
                <p id="balanceTxt" class="text-white font-black">0.30 AZN</p>
            </div>
            <div class="glass p-3 rounded-2xl text-right">
                <p class="text-[10px] text-emerald-400 font-bold uppercase">Məsafə</p>
                <p id="scoreTxt" class="text-white font-black">0 M</p>
            </div>
        </div>

        <div id="gameOver" class="hidden text-center bg-black/80 p-8 rounded-3xl border-2 border-rose-500">
            <h2 class="text-3xl font-black text-rose-500 mb-4">GAME OVER</h2>
            <button onclick="location.reload()" class="interactive px-8 py-3 bg-white text-black font-bold rounded-xl">YENİDƏN</button>
        </div>

        <div class="w-full max-w-sm mx-auto pb-6">
            <button id="brakeBtn" class="interactive w-full py-8 bg-rose-600 rounded-[35px] text-white text-2xl font-black shadow-2xl shadow-rose-900/50 active:bg-rose-700 transition-all">
                TORMOZ
            </button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('startScreen');
        const startBtn = document.getElementById('startBtn');
        const brakeBtn = document.getElementById('brakeBtn');

        let width, height, lanes;
        let balance = 0.30;
        let score = 0;
        let isRunning = false;
        let isBraking = false;
        
        const player = { lane: 1, x: 0, targetX: 0, y: 0 };
        let traffic = [];
        let offset = 0;
        let speed = 5;

        function init() {
            width = Math.min(window.innerWidth, 450);
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            lanes = [width * 0.2, width * 0.5, width * 0.8];
            player.x = lanes[1];
            player.targetX = lanes[1];
            player.y = height - 160;
        }

        window.addEventListener('resize', init);
        init();

        function update() {
            if (!isRunning) return;

            const currentSpeed = isBraking ? 0 : speed;
            offset = (offset + currentSpeed) % 60;
            score += currentSpeed / 20;

            // Oyunçu hərəkəti
            player.x += (player.targetX - player.x) * 0.2;

            // Trafik yaratma
            if (Math.random() < 0.02 && !isBraking) {
                if (traffic.length === 0 || traffic[traffic.length-1].y > 250) {
                    traffic.push({
                        x: lanes[Math.floor(Math.random() * 3)],
                        y: -100,
                        speed: 2 + Math.random() * 2
                    });
                }
            }

            // Trafik hərəkəti və toqquşma
            traffic.forEach((car, i) => {
                car.y += currentSpeed + (isBraking ? car.speed : car.speed - 2.5);

                // Toqquşma məntiqi (asanlaşdırılıb)
                if (Math.abs(car.x - player.x) < 40 && Math.abs(car.y - player.y) < 70) {
                    balance -= 0.10;
                    traffic.splice(i, 1);
                    document.getElementById('balanceTxt').innerText = balance.toFixed(2) + " AZN";
                    if (balance <= 0) {
                        isRunning = false;
                        document.getElementById('gameOver').classList.remove('hidden');
                    }
                }

                if (car.y > height + 100) traffic.splice(i, 1);
            });

            if (speed < 10) speed += 0.0005;
            document.getElementById('scoreTxt').innerText = Math.floor(score) + " M";
        }

        function draw() {
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, width, height);

            // Yol xətləri
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.setLineDash([20, 40]);
            ctx.lineDashOffset = -offset;
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(width * 0.35, 0); ctx.lineTo(width * 0.35, height);
            ctx.moveTo(width * 0.65, 0); ctx.lineTo(width * 0.65, height);
            ctx.stroke();

            // Trafik maşınları
            traffic.forEach(car => {
                ctx.fillStyle = '#f43f5e';
                ctx.beginPath();
                ctx.roundRect(car.x - 22, car.y - 40, 44, 80, 8);
                ctx.fill();
            });

            // Oyunçu maşını
            ctx.fillStyle = '#0ea5e9';
            ctx.beginPath();
            ctx.roundRect(player.x - 22, player.y - 40, 44, 80, 8);
            ctx.fill();
            // İşıqlar
            ctx.fillStyle = '#fef08a';
            ctx.fillRect(player.x - 18, player.y - 38, 8, 4);
            ctx.fillRect(player.x + 10, player.y - 38, 8, 4);
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        // İdarəetmə
        startBtn.onclick = () => {
            startScreen.classList.add('hidden');
            isRunning = true;
        };

        window.addEventListener('touchstart', (e) => {
            if (!isRunning) return;
            const touchX = e.touches[0].clientX;
            if (touchX < width / 2) {
                if (player.targetX === lanes[1]) player.targetX = lanes[0];
                else if (player.targetX === lanes[2]) player.targetX = lanes[1];
            } else {
                if (player.targetX === lanes[1]) player.targetX = lanes[2];
                else if (player.targetX === lanes[0]) player.targetX = lanes[1];
            }
        });

        const toggleBrake = (val) => (e) => { e.preventDefault(); isBraking = val; };
        brakeBtn.onmousedown = toggleBrake(true);
        brakeBtn.onmouseup = toggleBrake(false);
        brakeBtn.ontouchstart = toggleBrake(true);
        brakeBtn.ontouchend = toggleBrake(false);

        loop();
    </script>
</body>
</html>
