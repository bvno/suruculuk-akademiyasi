<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Premium Drive - Play & Earn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --glass: rgba(15, 23, 42, 0.8);
            --neon-cyan: #22d3ee;
            --neon-rose: #f43f5e;
            --neon-emerald: #10b981;
        }
        body {
            margin: 0;
            padding: 0;
            background: #020617;
            color: white;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            height: 100dvh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #gameCanvas {
            background: #0f172a;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            display: none;
        }
        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
        }
        .neon-border-cyan { border: 2px solid var(--neon-cyan); box-shadow: 0 0 15px var(--neon-cyan); }
        .btn-brake {
            user-select: none;
            touch-action: manipulation;
            transition: transform 0.1s;
        }
        .btn-brake:active { transform: scale(0.9); background: #991b1b !important; }
        
        /* Animasiyalar */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            20% { transform: translate(-3px, 0px) rotate(-1deg); }
            40% { transform: translate(3px, 2px) rotate(1deg); }
            100% { transform: translate(1px, -1px) rotate(0deg); }
        }
        .shake { animation: shake 0.5s; }
        
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .pointer-events-auto { pointer-events: auto; }
    </style>
</head>
<body>

<div id="auth-screen" class="glass-panel p-8 w-full max-w-md mx-4 pointer-events-auto z-50">
    <h1 class="text-3xl font-bold mb-6 text-center text-cyan-400">PREMIUM DRIVE</h1>
    <div class="space-y-4" id="reg-form">
        <input type="text" id="reg-name" placeholder="Ad Soyad" class="w-full p-3 rounded bg-slate-800 border border-slate-700 outline-none focus:border-cyan-400">
        <input type="text" id="reg-user" placeholder="ƒ∞stifad…ô√ßi adƒ±" class="w-full p-3 rounded bg-slate-800 border border-slate-700">
        <input type="number" id="reg-age" placeholder="Ya≈ü" class="w-full p-3 rounded bg-slate-800 border border-slate-700">
        <input type="password" id="reg-pass" placeholder="≈ûifr…ô (min 6 simvol)" class="w-full p-3 rounded bg-slate-800 border border-slate-700">
        <p class="text-xs text-slate-400 italic">Qeyd: H…ôr cihazdan 1 hesab. Sƒ±fƒ±r balansla oyun qadaƒüandƒ±r.</p>
        <button onclick="register()" class="w-full py-3 bg-cyan-600 hover:bg-cyan-500 rounded-xl font-bold transition">QEYDƒ∞YYATDAN KE√á</button>
    </div>
</div>

<div id="main-menu" class="hidden glass-panel p-8 w-full max-w-md mx-4 pointer-events-auto z-50">
    <div class="flex justify-between items-center mb-6">
        <div>
            <p class="text-slate-400 text-sm">Xo≈ü g…ôldin,</p>
            <h2 id="display-name" class="text-xl font-bold">ƒ∞stifad…ô√ßi</h2>
        </div>
        <div class="text-right">
            <p class="text-slate-400 text-sm">Balans:</p>
            <h2 id="display-balance" class="text-xl font-bold text-emerald-400">0.00 AZN</h2>
        </div>
    </div>
    
    <div class="grid grid-cols-2 gap-4 mb-6">
        <button onclick="startGame()" class="col-span-2 py-4 bg-emerald-600 hover:bg-emerald-500 rounded-xl font-bold text-lg shadow-lg shadow-emerald-900/20">S√úR√ú≈û∆è BA≈ûLA</button>
        <button onclick="dailyBonus()" class="py-3 bg-slate-800 rounded-xl text-sm border border-slate-700">G√ºnd…ôlik Bonus</button>
        <button onclick="showTopup()" class="py-3 bg-rose-600 rounded-xl text-sm font-bold">Balansƒ± Artƒ±r</button>
    </div>

    <div class="flex justify-center gap-2">
        <select id="lang-select" onchange="changeLang()" class="bg-slate-900 border border-slate-700 rounded p-1 text-xs">
            <option value="AZ">AZ</option>
            <option value="EN">EN</option>
            <option value="RU">RU</option>
            <option value="TR">TR</option>
        </select>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<div id="ui-layer" class="hidden">
    <div class="p-4 flex justify-between items-start">
        <div class="glass-panel p-3 px-6">
            <p class="text-xs text-slate-400">BALANS</p>
            <p id="ingame-balance" class="text-xl font-mono font-bold text-emerald-400">0.00 AZN</p>
        </div>
        <div class="glass-panel p-3 px-6 text-right">
            <p id="combo-text" class="text-xs text-rose-400 font-bold">KOMBO x1</p>
            <p id="ingame-score" class="text-xl font-mono font-bold">0</p>
        </div>
    </div>

    <div id="ai-msg" class="absolute top-1/4 left-1/2 -translate-x-1/2 text-center opacity-0 transition-opacity">
        <p class="glass-panel px-4 py-2 text-cyan-400 text-sm font-bold border-cyan-500/50"></p>
    </div>

    <div id="status-alert" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center hidden">
        <h1 id="status-title" class="text-4xl font-black italic tracking-tighter"></h1>
        <p id="status-desc" class="text-lg font-bold"></p>
    </div>

    <div class="absolute bottom-10 left-1/2 -translate-x-1/2 pointer-events-auto">
        <button id="brake-btn" class="btn-brake w-32 h-32 rounded-full bg-red-700 border-8 border-red-900 shadow-2xl flex items-center justify-center font-black text-xl">TORMOZ</button>
    </div>
</div>

<div id="block-screen" class="hidden fixed inset-0 bg-slate-950/95 z-[100] flex items-center justify-center p-6 text-center">
    <div class="glass-panel p-8 border-rose-500/50 max-w-sm">
        <h2 class="text-3xl font-bold text-rose-500 mb-4">BALANS Bƒ∞TDƒ∞! üõë</h2>
        <p class="text-slate-300 mb-6 text-sm">C…ôrim…ôl…ôr n…ôtic…ôsind…ô balansƒ±nƒ±z sƒ±fƒ±rlandƒ±. Davam etm…ôk √º√ß√ºn minimum 3 AZN y√ºkl…ôm…ôlisiniz.</p>
        <a href="https://buymeacoffee.com/surwin" target="_blank" class="block w-full py-4 bg-rose-600 rounded-xl font-bold mb-4">BALANSI ARTIR (3 AZN)</a>
        <p class="text-[10px] text-slate-500">√ñd…ôni≈üd…ôn sonra "√ñd…ôni≈üi Yoxla" d√ºym…ôsin…ô klikl…ôyin.</p>
    </div>
</div>

<script>
/** * PREMIUM DRIVE - CORE ENGINE
 * M…ôntiq: Canvas √ºz…ôrind…ô 3 zolaqlƒ± sonsuz yol.
 */

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const UI = {
    auth: document.getElementById('auth-screen'),
    menu: document.getElementById('main-menu'),
    layer: document.getElementById('ui-layer'),
    balance: document.getElementById('display-balance'),
    ingameBalance: document.getElementById('ingame-balance'),
    status: document.getElementById('status-alert'),
    aiMsg: document.getElementById('ai-msg'),
    block: document.getElementById('block-screen')
};

// Global State
let user = JSON.parse(localStorage.getItem('pd_user')) || null;
let gameState = 'MENU'; 
let balance = 0;
let score = 0;
let combo = 1;
let speed = 5;
let laneWidth = 0;
let playerLane = 1; // 0, 1, 2
let objects = [];
let isBraking = false;
let lastUpdate = 0;
let policeTimer = 0;
let isPoliceWaiting = false;

// Config & Currencies
const CURRENCY = { AZ: 1, EN: 0.58, RU: 55, TR: 18 }; // N√ºmun…ô m…ôz…ônn…ôl…ôr
let currentLang = 'AZ';

// Ba≈ülanƒüƒ±c Yoxlanƒ±≈üƒ±
window.onload = () => {
    if(user) {
        balance = user.balance;
        showMenu();
    }
};

function register() {
    const name = document.getElementById('reg-name').value;
    const username = document.getElementById('reg-user').value;
    const pass = document.getElementById('reg-pass').value;
    
    if(name && username && pass.length >= 6) {
        user = { name, username, balance: 0.00, firstBonus: false };
        localStorage.setItem('pd_user', JSON.stringify(user));
        showMenu();
    } else {
        alert("M…ôlumatlarƒ± d√ºzg√ºn daxil edin!");
    }
}

function showMenu() {
    UI.auth.classList.add('hidden');
    UI.menu.classList.remove('hidden');
    UI.balance.innerText = `${balance.toFixed(2)} AZN`;
    document.getElementById('display-name').innerText = user.name;
}

function showTopup() {
    if(!user.firstBonus) {
        balance += 0.50;
        user.firstBonus = true;
        updateBalance(0);
        alert("T…ôbrikl…ôr! 0.50 AZN Ba≈ülanƒüƒ±c Bonusu aldƒ±nƒ±z.");
    } else {
        window.open("https://buymeacoffee.com/surwin", "_blank");
    }
}

function updateBalance(amount) {
    balance += amount;
    if(balance < 0) balance = 0;
    user.balance = balance;
    localStorage.setItem('pd_user', JSON.stringify(user));
    UI.balance.innerText = `${balance.toFixed(2)} AZN`;
    UI.ingameBalance.innerText = `${balance.toFixed(2)} AZN`;
    
    if(balance <= 0 && gameState === 'PLAYING') {
        endGame(true);
    }
}

// OYUN MEXANƒ∞KASI
function startGame() {
    if(balance <= 0) {
        UI.block.classList.remove('hidden');
        return;
    }
    
    gameState = 'PLAYING';
    UI.menu.classList.add('hidden');
    UI.layer.classList.remove('hidden');
    canvas.style.display = 'block';
    
    resize();
    resetGame();
    requestAnimationFrame(gameLoop);
}

function resetGame() {
    score = 0;
    combo = 1;
    speed = 7;
    objects = [];
    playerLane = 1;
}

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    laneWidth = canvas.width / 3;
}

// Inputlar
window.addEventListener('mousedown', (e) => {
    if(gameState !== 'PLAYING') return;
    if(e.target.id === 'brake-btn') { isBraking = true; return; }
    
    if(e.clientX < canvas.width / 2) {
        if(playerLane > 0) playerLane--;
    } else {
        if(playerLane < 2) playerLane++;
    }
});

const brakeBtn = document.getElementById('brake-btn');
brakeBtn.addEventListener('touchstart', (e) => { e.preventDefault(); isBraking = true; });
brakeBtn.addEventListener('touchend', () => { isBraking = false; });
window.addEventListener('mouseup', () => { isBraking = false; });

function gameLoop(timestamp) {
    if(gameState !== 'PLAYING') return;
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Yol cizgil…ôri
    drawRoad();
    
    // Oyun s√ºr…ôti
    let currentSpeed = isBraking ? 0 : speed;
    if(!isBraking) speed += 0.001; 

    // Obyektl…ôrin idar…ôsi
    if(Math.random() < 0.02 && !isBraking) spawnObject();
    
    updateObjects(currentSpeed);
    drawPlayer();
    
    // UI Update
    score += (currentSpeed / 10);
    document.getElementById('ingame-score').innerText = Math.floor(score);
    
    requestAnimationFrame(gameLoop);
}

function drawRoad() {
    ctx.strokeStyle = "rgba(255,255,255,0.1)";
    ctx.setLineDash([20, 20]);
    ctx.beginPath();
    ctx.moveTo(laneWidth, 0); ctx.lineTo(laneWidth, canvas.height);
    ctx.moveTo(laneWidth*2, 0); ctx.lineTo(laneWidth*2, canvas.height);
    ctx.stroke();
}

function drawPlayer() {
    const x = playerLane * laneWidth + (laneWidth/2) - 25;
    const y = canvas.height - 150;
    
    // Ma≈üƒ±n vizualƒ± (Neon)
    ctx.fillStyle = "#22d3ee";
    ctx.shadowBlur = 15;
    ctx.shadowColor = "#22d3ee";
    ctx.fillRect(x, y, 50, 90);
    ctx.shadowBlur = 0;
}

function spawnObject() {
    const types = ['CAR', 'LIGHT', 'POLICE'];
    const type = types[Math.floor(Math.random() * types.length)];
    objects.push({
        x: Math.floor(Math.random() * 3) * laneWidth + (laneWidth/2) - 20,
        y: -100,
        type: type,
        passed: false
    });
}

function updateObjects(s) {
    objects.forEach((obj, index) => {
        obj.y += s;
        
        // R…ôngl…ôm…ô
        if(obj.type === 'CAR') ctx.fillStyle = "#f43f5e";
        if(obj.type === 'LIGHT') ctx.fillStyle = "#10b981";
        if(obj.type === 'POLICE') ctx.fillStyle = "#3b82f6";
        
        ctx.fillRect(obj.x, obj.y, 40, 70);
        
        // Toqqu≈üma
        const playerX = playerLane * laneWidth + (laneWidth/2) - 25;
        const playerY = canvas.height - 150;
        
        if(obj.y > playerY - 40 && obj.y < playerY + 90 && obj.x > playerX - 30 && obj.x < playerX + 40) {
            handleCollision(obj, index);
        }
        
        // Ekrandan √ßƒ±xma
        if(obj.y > canvas.height) objects.splice(index, 1);
    });
}

function handleCollision(obj, index) {
    if(obj.type === 'CAR') {
        triggerShake();
        updateBalance(-0.10);
        objects.splice(index, 1);
        speakAI("Q…ôza etdin, diqq…ôtli ol!");
    }
    
    if(obj.type === 'LIGHT') {
        if(!isBraking) {
            updateBalance(0.40);
            speakAI("M√ºk…ômm…ôl ke√ßid! +0.40");
        } else {
            updateBalance(-0.60);
        }
        objects.splice(index, 1);
    }

    if(obj.type === 'POLICE') {
        if(!isBraking) {
            updateBalance(-0.60);
            speakAI("Polisd…ôn qa√ßma!");
        } else {
            // Polis saxlama m…ôntiqi (Sad…ôl…ô≈üdirilmi≈ü)
            isPoliceWaiting = true;
            setTimeout(() => {
                if(isBraking) {
                    updateBalance(0.30);
                    speakAI("Yolun a√ßƒ±q olsun!");
                }
                isPoliceWaiting = false;
            }, 3000);
        }
        objects.splice(index, 1);
    }
}

function triggerShake() {
    document.body.classList.add('shake');
    setTimeout(() => document.body.classList.remove('shake'), 500);
}

// AI K√ñM∆èK√áƒ∞Sƒ∞ (Simulyasiya - Gemini API integration point)
async function speakAI(text) {
    const aiBox = UI.aiMsg;
    aiBox.querySelector('p').innerText = text;
    aiBox.style.opacity = 1;
    
    // Burada Gemini API-y…ô sorƒüu g√∂nd…ôril…ô bil…ôr
    // const response = await fetch('YOUR_GEMINI_ENDPOINT_HERE');
    
    setTimeout(() => aiBox.style.opacity = 0, 3000);
}

function endGame(isBlocked = false) {
    gameState = 'MENU';
    canvas.style.display = 'none';
    UI.layer.classList.add('hidden');
    
    if(isBlocked) {
        UI.block.classList.remove('hidden');
    } else {
        showMenu();
    }
}

function dailyBonus() {
    const lastBonus = localStorage.getItem('pd_last_bonus');
    const now = new Date().toDateString();
    
    if(lastBonus !== now) {
        updateBalance(0.20);
        localStorage.setItem('pd_last_bonus', now);
        alert("G√ºnd…ôlik bonus +0.20 AZN …ôlav…ô edildi!");
    } else {
        alert("Bu g√ºn artƒ±q bonus almƒ±sƒ±nƒ±z.");
    }
}

// RoundRect Polyfill
if (!Path2D.prototype.roundRect) {
    Path2D.prototype.roundRect = function (x, y, width, height, radii) {
        this.rect(x, y, width, height);
    };
}
</script>
</body>
</html>
