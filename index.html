<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Premium Drive - Play & Earn</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            height: 100vh; height: 100dvh; 
            user-select: none; -webkit-user-select: none; touch-action: none; 
            overflow: hidden; background-color: #020617; font-family: 'Arial', sans-serif; 
            transition: direction 0.3s ease; 
        } 
        .hidden { display: none !important; }
        
        [dir="rtl"] { font-family: 'Tahoma', 'Arial', sans-serif; }
        [dir="rtl"] .text-left { text-align: right; }
        [dir="rtl"] .pl-4 { padding-right: 1rem; padding-left: 0; }
        
        .glass-panel {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }
        .neon-cyan { text-shadow: 0 0 10px rgba(34, 211, 238, 0.8); }
        .neon-emerald { text-shadow: 0 0 10px rgba(16, 185, 129, 0.8); }
        .neon-rose { text-shadow: 0 0 10px rgba(244, 63, 94, 0.8); }
        .neon-box-cyan { box-shadow: 0 0 20px rgba(34, 211, 238, 0.15); }
        .brake-shadow { box-shadow: 0 0 40px rgba(225, 29, 72, 0.6); }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(34,211,238,0.3); border-radius: 10px; }

        @keyframes shake {
            0%, 100% { transform: translate(0, 0); }
            20% { transform: translate(-3px, 2px); }
            40% { transform: translate(3px, -2px); }
            60% { transform: translate(-3px, -2px); }
            80% { transform: translate(3px, 2px); }
        }
        .shake-effect { animation: shake 0.3s; }
    </style>
</head>
<body class="text-white flex flex-col font-sans relative" dir="ltr">

    <div class="fixed top-4 right-4 z-[9999]">
        <div id="langBtn" class="glass-panel px-3 py-2 rounded-[16px] flex items-center gap-2 cursor-pointer border border-white/10 active:scale-95 transition-transform bg-[#020617]/90">
            <span id="currentFlag">üá¶üáø</span> <span id="currentLangName" class="text-xs font-bold uppercase">AZ</span>
        </div>
        <div id="langDropdown" class="hidden absolute top-full right-0 mt-2 p-2 glass-panel rounded-[16px] flex flex-col gap-1 w-36 border border-white/10 bg-[#020617]/95"></div>
    </div>

    <div id="toastContainer" class="absolute top-16 left-0 right-0 flex flex-col items-center z-[100] gap-2 pointer-events-none"></div>

    <div id="registrationScreen" class="h-full w-full flex items-center justify-center p-4 z-[60] absolute inset-0 bg-[#020617] overflow-y-auto hidden">
        <div class="glass-panel p-6 sm:p-8 rounded-[32px] w-full max-w-md relative overflow-hidden my-auto mt-12">
            <h2 class="text-2xl font-black mb-4 neon-cyan text-center" data-i18n="regTitle">Qeydiyyat & Qaydalar</h2>
            
            <div class="bg-[#0f172a]/90 p-4 rounded-[20px] mb-6 border border-white/10 text-[11px] sm:text-xs text-slate-300 space-y-2 h-40 overflow-y-auto custom-scrollbar text-left">
                <p class="text-rose-400 font-bold mb-1" data-i18n="regAttention">Dƒ∞QQ∆èT - Vacib Qaydalar:</p>
                <ul class="list-disc pl-4 space-y-1.5">
                    <li data-i18n="rule1">H…ôr bir istifad…ô√ßi yalnƒ±z <b>1 d…ôf…ô</b> qeydiyyatdan ke√ß…ô bil…ôr.</li>
                    <li data-i18n="rule2">Eyni cihazdan bird…ôn √ßox hesab yaradƒ±larsa, sistem avtomatik <b>ban ed…ôc…ôk</b>.</li>
                    <li data-i18n="rule3">Qeydiyyatdan sonra 'Balansƒ± Artƒ±r' b√∂lm…ôsind…ô '√ñd…ôni≈üi Yoxla' d√ºym…ôsin…ô basaraq <b>0.50 AZN</b> ba≈ülanƒüƒ±c h…ôdiyy…ônizi ala bil…ôrsiniz.</li>
                    <li data-i18n="rule4">Qaydalara (i≈üƒ±qfor, polis) riay…ôt ed…ôr…ôk qazanc …ôld…ô ed…ô bil…ôrsiniz.</li>
                    <li data-i18n="rule5">Oyuna davam etm…ôk √º√ß√ºn balans 0 olduqda m√ºtl…ôq artƒ±rmalƒ±sƒ±nƒ±z.</li>
                </ul>
                <p class="text-emerald-400 font-bold mt-3 text-center text-sm" data-i18n="regWish">Uƒüurlar arzulayƒ±rƒ±q! üèÅ</p>
            </div>

            <form id="regForm" class="flex flex-col gap-3 relative z-10">
                <input type="text" id="regName" data-i18n="phName" placeholder="Ad v…ô Soyad" required class="w-full p-3.5 rounded-xl bg-[#020617] border border-slate-700 text-white outline-none focus:border-cyan-500 text-sm">
                <input type="text" id="regUsername" data-i18n="phUsername" placeholder="ƒ∞stifad…ô√ßi adƒ±" required class="w-full p-3.5 rounded-xl bg-[#020617] border border-slate-700 text-white outline-none focus:border-cyan-500 text-sm">
                <input type="number" id="regAge" data-i18n="phAge" placeholder="Ya≈ü" required min="10" max="99" class="w-full p-3.5 rounded-xl bg-[#020617] border border-slate-700 text-white outline-none focus:border-cyan-500 text-sm">
                <input type="password" id="regPassword" data-i18n="phPass" placeholder="≈ûifr…ô" required minlength="6" class="w-full p-3.5 rounded-xl bg-[#020617] border border-slate-700 text-white outline-none focus:border-cyan-500 text-sm">
                
                <button type="submit" data-i18n="btnReg" class="w-full py-4 mt-2 bg-cyan-500/20 border border-cyan-500/50 text-cyan-300 rounded-[24px] font-bold uppercase tracking-widest shadow-[0_0_15px_rgba(34,211,238,0.2)] active:scale-95 transition-all">Qeydiyyatƒ± Tamamla</button>
            </form>
        </div>
    </div>

    <div id="loginScreen" class="h-full w-full flex items-center justify-center p-6 z-50 absolute inset-0 bg-[#020617] hidden">
        <div class="glass-panel p-8 rounded-[32px] w-full max-w-sm text-center relative overflow-hidden flex flex-col gap-4">
            <h1 class="text-3xl font-black text-white italic mb-2 tracking-tighter neon-cyan">PREMIUM DRIVE</h1>
            
            <div class="bg-[#0f172a] p-4 rounded-2xl border border-white/5 flex justify-between items-center">
                <div class="text-left">
                    <p class="text-[10px] text-slate-400 uppercase tracking-widest" data-i18n="lblLoginBal">Cari Balans</p>
                    <p id="loginBalanceText" class="text-xl font-bold text-cyan-400 neon-cyan">0.00 AZN</p>
                </div>
                <div class="text-right">
                    <p class="text-[10px] text-slate-400 uppercase tracking-widest" data-i18n="lblScore">Rekord</p>
                    <p id="loginScoreText" class="text-lg font-bold text-emerald-400">0 M</p>
                </div>
            </div>

            <button id="loginBtn" data-i18n="btnPlay" class="w-full py-4 bg-cyan-500/20 border border-cyan-500/50 text-cyan-300 rounded-[24px] font-bold uppercase tracking-widest shadow-[0_0_15px_rgba(34,211,238,0.2)] active:scale-95 transition-all">
                Oyuna Ba≈üla
            </button>
            
            <div class="grid grid-cols-2 gap-3 mt-2">
                <button id="btnDaily" class="py-3 bg-indigo-500/20 border border-indigo-500/50 text-indigo-300 rounded-[20px] font-bold text-sm active:scale-95 transition-all" data-i18n="btnDaily">
                    üéÅ G√ºnd…ôlik
                </button>
                <button id="btnAch" class="py-3 bg-amber-500/20 border border-amber-500/50 text-amber-300 rounded-[20px] font-bold text-sm active:scale-95 transition-all" data-i18n="btnAch">
                    üèÜ Nailiyy…ôtl…ôr
                </button>
            </div>

            <button id="loginTopupBtn" data-i18n="btnTopup" class="w-full py-3 glass-panel rounded-[20px] text-white font-bold uppercase tracking-widest active:scale-95 transition-all border border-white/10 mt-2">
                Balansƒ± Artƒ±r
            </button>
        </div>
    </div>

    <div id="achModal" class="hidden absolute inset-0 bg-[#020617]/95 z-50 flex items-center justify-center p-6">
        <div class="glass-panel p-6 rounded-[32px] w-full max-w-sm flex flex-col max-h-[80vh]">
            <h2 class="text-2xl font-bold text-amber-400 mb-4 text-center" data-i18n="btnAch">Nailiyy…ôtl…ôr</h2>
            <div id="achList" class="flex-1 overflow-y-auto space-y-3 pr-2 custom-scrollbar"></div>
            <button id="closeAch" data-i18n="btnClose" class="mt-4 py-3 bg-slate-700 rounded-xl font-bold w-full">Baƒüla</button>
        </div>
    </div>

    <div id="gameScreen" class="hidden h-full w-full flex flex-col relative overflow-hidden bg-[#020617]">
        
        <div class="p-4 flex justify-between items-center z-30 shrink-0">
            <div class="flex gap-2">
                <div class="glass-panel p-2 px-3 rounded-[20px]">
                    <p data-i18n="garBal" class="text-[9px] font-black text-cyan-400 uppercase tracking-[2px] mb-0.5 opacity-80">Balans</p>
                    <p id="balanceText" class="text-sm font-black neon-cyan">0.00 AZN</p>
                </div>
                <div class="glass-panel p-2 px-3 rounded-[20px]">
                    <p data-i18n="lblScoreCombo" class="text-[9px] font-black text-emerald-400 uppercase tracking-[2px] mb-0.5 opacity-80">M…ôsaf…ô / Kombo</p>
                    <p class="text-sm font-black text-white"><span id="scoreText">0</span> <span id="comboText" class="text-amber-400 ml-1">x1</span></p>
                </div>
            </div>
            <div class="flex gap-2">
                <button id="withdrawBtn" class="w-10 h-10 bg-cyan-500/20 border border-cyan-500/50 text-cyan-400 rounded-[15px] flex items-center justify-center shadow-[0_0_10px_rgba(34,211,238,0.2)] active:scale-95 transition-all">üí∏</button>
                <button id="garageBtn" class="w-10 h-10 bg-indigo-500/20 border border-indigo-500/50 text-indigo-400 rounded-[15px] flex items-center justify-center shadow-[0_0_10px_rgba(99,102,241,0.2)] active:scale-95 transition-all">üõí</button>
                <button id="topupBtn" class="w-10 h-10 bg-[#FFDD00]/20 border border-[#FFDD00]/50 text-[#FFDD00] rounded-[15px] flex items-center justify-center shadow-[0_0_10px_rgba(255,221,0,0.2)] active:scale-95 transition-all">‚òï</button>
            </div>
        </div>

        <div class="px-4 z-30 mb-2 shrink-0">
            <div class="glass-panel border-blue-500/30 rounded-[20px] p-2 px-3 text-xs text-blue-100 flex items-center gap-3">
                <div class="w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center border border-blue-500/40 shrink-0"><span id="aiIcon" class="text-[10px]">ü§ñ</span></div>
                <span id="aiTipText" data-i18n="aiTipLoad" class="truncate w-full italic font-light text-[11px]">Davam et!</span>
            </div>
        </div>

        <div class="flex-1 w-full max-w-[400px] mx-auto relative glass-panel neon-box-cyan rounded-[40px] overflow-hidden z-10 flex shrink" id="gameContainer">
            <canvas id="gameCanvas" width="400" height="600" class="w-full h-full object-contain bg-[#0f172a]"></canvas>
            
            <div class="absolute inset-0 flex z-20">
                <div id="laneLeft" class="flex-1 active:bg-white/5 cursor-pointer"></div>
                <div id="laneRight" class="flex-1 active:bg-white/5 cursor-pointer"></div>
            </div>
            
            <div id="gameOverScreen" class="hidden absolute inset-0 bg-[#020617]/95 backdrop-blur-xl flex-col items-center justify-center p-6 text-center z-40">
                <div class="w-20 h-20 rounded-full bg-rose-500/20 flex items-center justify-center mb-4 blur-[2px] mx-auto"><span class="text-4xl">‚ö†Ô∏è</span></div>
                <h2 class="text-3xl font-black text-rose-500 mb-2 neon-rose tracking-wider" data-i18n="goTitle">GAME OVER</h2>
                <p class="text-slate-300 text-sm mb-4"><span data-i18n="lblDist">M…ôsaf…ô</span>: <span id="finalScore" class="font-bold text-white text-lg">0</span> M</p>
                
                <div id="gameOverMessage" class="hidden mb-6 bg-rose-500/10 p-4 rounded-xl border border-rose-500/30 text-left">
                    <p class="text-rose-400 text-sm font-bold mb-1" data-i18n="goMsgTitle">Balansƒ±nƒ±z 0.00 oldu!</p>
                    <p class="text-slate-300 text-xs" data-i18n="goMsgDesc">C…ôrim…ôl…ôr s…ôb…ôbind…ôn balansƒ±nƒ±z bitdi. Oyuna davam etm…ôk √º√ß√ºn m√ºtl…ôq balansƒ±nƒ±zƒ± artƒ±rmalƒ±sƒ±nƒ±z. ƒ∞kinci ≈üans verilmir.</p>
                </div>
                
                <button id="restartBtn" data-i18n="btnRestart" class="w-full py-4 bg-cyan-500/20 border border-cyan-500/50 text-cyan-300 rounded-[24px] font-bold uppercase tracking-widest shadow-[0_0_15px_rgba(34,211,238,0.2)] mb-3 active:scale-95 transition-all">YENƒ∞D∆èN BA≈ûLA</button>
                <button id="btnGoMenu" data-i18n="btnMenu" class="w-full py-3 bg-transparent border border-slate-600 text-slate-300 rounded-[24px] font-bold uppercase active:scale-95 transition-all mb-3">ANA MENYU</button>
                <button id="gameOverTopupBtn" data-i18n="btnGoTopup" class="hidden w-full py-4 bg-[#FFDD00] text-black rounded-[24px] font-black uppercase tracking-widest shadow-[0_0_20px_rgba(255,221,0,0.3)] active:scale-95 transition-all flex items-center justify-center gap-2">BALANSI ARTIR</button>
            </div>
        </div>

        <div class="w-full max-w-[400px] mx-auto p-4 pb-6 shrink-0 z-20">
            <button id="brakeBtn" data-i18n="btnBrake" class="w-full py-6 rounded-[32px] text-3xl font-black tracking-widest transition-all bg-rose-600 border-b-8 border-rose-800 text-white brake-shadow active:border-b-0 active:translate-y-2 active:bg-rose-500 select-none touch-manipulation">TORMOZ</button>
        </div>
    </div>

    <div id="topUpModal" class="hidden absolute inset-0 bg-[#020617]/95 backdrop-blur-2xl flex items-center justify-center p-6 z-[100] overflow-y-auto">
        <div class="glass-panel p-6 rounded-[40px] text-center w-full max-w-md relative overflow-hidden my-auto">
            <h2 class="text-2xl font-black mb-4 neon-emerald relative z-10" data-i18n="tuTitle">Balansƒ± Artƒ±r</h2>
            <div class="text-slate-300 text-xs mb-6 relative z-10 space-y-3 text-left bg-[#0f172a]/80 p-4 rounded-[20px] border border-white/5 shadow-inner">
                <p class="flex items-start gap-2"><span class="text-emerald-400 mt-0.5">‚úî</span><span data-i18n="tuRule1">Balans artƒ±rmaq √º√ß√ºn link…ô daxil olaraq minimum <b>3 AZN</b> √∂d…ôni≈ü edin.</span></p>
                <p class="flex items-start gap-2"><span class="text-emerald-400 mt-0.5">‚úî</span><span data-i18n="tuRule2">√ñd…ôni≈ü t…ôsdiql…ôndikd…ôn sonra m…ôbl…ôƒü oyun balansƒ±nƒ±za …ôlav…ô olunacaq.</span></p>
                <p class="flex items-start gap-2"><span class="text-rose-400 mt-0.5">‚ö†Ô∏è</span><span data-i18n="tuRule3">Sƒ±fƒ±r balansla oyuna ba≈ülamaq qadaƒüandƒ±r. ƒ∞kinci ≈üans verilmir.</span></p>
            </div>
            <button id="buyMeCoffeeBtn" class="w-full py-4 bg-[#FFDD00] text-black rounded-[24px] font-black shadow-[0_0_20px_rgba(255,221,0,0.3)] mb-4 active:scale-95 transition-all relative z-10 flex items-center justify-center gap-3 text-lg"><span class="text-2xl">‚òï</span> <span data-i18n="btnPay">√ñd…ôni≈ü Et</span></button>
            <button id="verifyPaymentBtn" data-i18n="btnVerify" class="w-full py-3 bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 rounded-[24px] font-bold mb-4 active:scale-95 transition-all relative z-10 text-sm flex items-center justify-center gap-2">üîÑ √ñd…ôni≈üi Yoxla / Bonus Al</button>
            <button id="closeTopUpBtn" data-i18n="btnClose" class="text-slate-400 text-[12px] font-bold uppercase tracking-widest active:text-white transition-all relative z-10">Baƒüla</button>
        </div>
    </div>

    <div id="withdrawModal" class="hidden absolute inset-0 bg-[#020617]/95 backdrop-blur-2xl flex items-center justify-center p-6 z-[100]">
        <div class="glass-panel p-8 rounded-[40px] text-center w-full max-w-sm relative overflow-hidden">
            <h2 class="text-2xl font-black mb-2 neon-cyan relative z-10" data-i18n="wdTitle">Naƒüdla≈üdƒ±r</h2>
            <div class="bg-[#0f172a] p-4 rounded-2xl mb-6 border border-white/5 relative z-10">
                <p class="text-[10px] text-slate-400 uppercase tracking-widest mb-1" data-i18n="wdCurBal">Cari Balansƒ±nƒ±z</p>
                <p id="withdrawBalanceDisplay" class="text-2xl font-black text-cyan-400 neon-cyan">0.00 AZN</p>
            </div>
            <form id="withdrawForm" action="#" method="POST" class="flex flex-col gap-3 relative z-10">
                <input type="text" id="wdName" data-i18n="wdPhName" placeholder="Ad v…ô Soyadƒ±nƒ±z" required class="w-full p-4 rounded-2xl bg-[#020617] border border-slate-700 text-white outline-none focus:border-cyan-500 text-sm">
                <input type="text" id="wdCard" data-i18n="wdPhCard" placeholder="Kart v…ô ya Hesab N√∂mr…ôsi" required class="w-full p-4 rounded-2xl bg-[#020617] border border-slate-700 text-white outline-none focus:border-cyan-500 text-sm">
                <p id="withdrawWarning" data-i18n="wdWarn" class="text-rose-500 text-xs font-bold mt-1 hidden">Balansƒ±nƒ±z minimum limitd…ôn (30 AZN) azdƒ±r.</p>
                <button type="submit" id="submitWithdrawBtn" data-i18n="btnSubmitWd" class="w-full py-4 mt-2 bg-cyan-500/20 border border-cyan-500/50 text-cyan-400 rounded-[24px] font-bold uppercase tracking-widest shadow-[0_0_15px_rgba(34,211,238,0.2)] active:scale-95 transition-all">Sorƒüu G√∂nd…ôr</button>
            </form>
            <button id="closeWithdrawBtn" data-i18n="btnBack" class="text-slate-400 text-[12px] font-bold uppercase tracking-widest mt-6 active:text-white transition-all relative z-10">Geri</button>
        </div>
    </div>

    <div id="garageModal" class="hidden absolute inset-0 bg-[#020617]/95 backdrop-blur-2xl flex flex-col items-center justify-center p-6 z-[100]">
        <div class="glass-panel p-6 rounded-[32px] w-full max-w-sm relative overflow-hidden flex flex-col max-h-[90%]">
            <div class="flex justify-between items-center mb-6 relative z-10">
                <h2 class="text-2xl font-black neon-cyan italic" data-i18n="garTitle">QARAJ</h2>
                <div class="text-right">
                    <p class="text-[10px] text-cyan-400 uppercase tracking-widest" data-i18n="garBal">Balans</p>
                    <p id="garageBalanceText" class="text-sm font-bold neon-cyan">0.00 AZN</p>
                </div>
            </div>
            <div id="garageList" class="flex-1 overflow-y-auto pr-2 space-y-4 relative z-10 custom-scrollbar"></div>
            <button id="closeGarageBtn" data-i18n="btnClose" class="w-full mt-6 py-4 glass-panel rounded-[20px] text-slate-300 font-bold uppercase tracking-widest active:scale-95 transition-all relative z-10">Baƒüla</button>
        </div>
    </div>

    <script>
        // Qrafik probleml…ôri h…ôll etm…ôk √º√ß√ºn x√ºsusi funksiya (roundRect …ôv…ôzi)
        function drawRoundedRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
            ctx.fill();
        }

        // ==========================================
        // Dƒ∞LL∆èR, VALYUTALAR V∆è NAƒ∞Lƒ∞YY∆èTL∆èR
        // ==========================================
        const LANGUAGES = {
            az: { 
                code: 'az', flag: 'üá¶üáø', name: 'Az…ôrbaycanca', currency: 'AZN', rate: 1, dir: 'ltr',
                t: {
                    regTitle: "Qeydiyyat & Qaydalar", regAttention: "Dƒ∞QQ∆èT - Vacib Qaydalar:",
                    rule1: "H…ôr bir istifad…ô√ßi yalnƒ±z <b>1 d…ôf…ô</b> qeydiyyatdan ke√ß…ô bil…ôr.",
                    rule2: "Eyni cihazdan bird…ôn √ßox hesab yaradƒ±larsa, sistem <b>ban ed…ôc…ôk</b>.",
                    rule3: "Qeydiyyatdan sonra 'Balansƒ± Artƒ±r'da '√ñd…ôni≈üi Yoxla' basaraq <b>0.50 AZN</b> h…ôdiyy…ônizi alƒ±n.",
                    rule4: "Qaydalara riay…ôt ed…ôr…ôk qazanc …ôld…ô ed…ô bil…ôrsiniz.",
                    rule5: "Oyuna davam etm…ôk √º√ß√ºn balans bitdikd…ô m√ºtl…ôq artƒ±rmalƒ±sƒ±nƒ±z.",
                    regWish: "Uƒüurlar arzulayƒ±rƒ±q! üèÅ", phName: "Ad v…ô Soyad", phUsername: "ƒ∞stifad…ô√ßi adƒ±", phAge: "Ya≈ü", phPass: "≈ûifr…ô",
                    btnReg: "Qeydiyyatƒ± Tamamla", lblLoginBal: "Cari Balans:", lblScore: "Rekord", btnPlay: "Oyuna Ba≈üla", btnTopup: "Balansƒ± Artƒ±r",
                    btnDaily: "üéÅ G√ºnd…ôlik", btnAch: "üèÜ Nailiyy…ôtl…ôr", lblScoreCombo: "M…ôsaf…ô / Kombo",
                    garBal: "Balans", lblDist: "M…ôsaf…ô", aiTipLoad: "M…ôsl…ôh…ôt√ßi: Davam et!", btnMenu: "ANA MENYU",
                    goTitle: "GAME OVER", goMsgTitle: "Balansƒ±nƒ±z sƒ±fƒ±rlandƒ±!", goMsgDesc: "C…ôrim…ôl…ôr s…ôb…ôbind…ôn balansƒ±nƒ±z bitdi. Oyuna davam etm…ôk √º√ß√ºn m√ºtl…ôq balansƒ±nƒ±zƒ± artƒ±rmalƒ±sƒ±nƒ±z.",
                    btnRestart: "YENƒ∞D∆èN BA≈ûLA", btnGoTopup: "BALANSI ARTIR", btnBrake: "TORMOZ",
                    tuTitle: "Balansƒ± Artƒ±r", tuRule1: "Balans artƒ±rmaq √º√ß√ºn (buymeacoffee.com/surwin) minimum <b>3 AZN</b> √∂d…ôni≈ü edin.", tuRule2: "√ñd…ôni≈ü t…ôsdiql…ôndikd…ôn sonra m…ôbl…ôƒü balansƒ±nƒ±za …ôlav…ô olunacaq.", tuRule3: "Sƒ±fƒ±r balansla oyuna ba≈ülamaq qadaƒüandƒ±r.",
                    btnPay: "√ñd…ôni≈ü Et", btnVerify: "√ñd…ôni≈üi Yoxla / Bonus Al", btnClose: "Baƒüla",
                    wdTitle: "Naƒüdla≈üdƒ±r", wdCurBal: "Cari Balansƒ±nƒ±z", wdPhName: "Ad v…ô Soyadƒ±nƒ±z", wdPhCard: "Kart v…ô ya Hesab N√∂mr…ôsi", wdWarn: "Balansƒ±nƒ±z limitd…ôn (30 AZN) azdƒ±r.", btnSubmitWd: "Sorƒüu G√∂nd…ôr", btnBack: "Geri", garTitle: "QARAJ",
                    btnSelected: "Se√ßilib", btnSelect: "Se√ß", btnBuy: "Al",
                    aiScenStart: "Qaza bas, ir…ôli!", aiScenEmpty: "Balansƒ±n bitib!", aiScenRed: "Qƒ±rmƒ±zƒ± i≈üƒ±q c…ôrim…ôsi!", aiScenGreen: "Ya≈üƒ±l i≈üƒ±q bonusu!", aiScenCrash: "Diqq…ôtli s√ºr, q…ôza!", aiScenNear: "∆èla sƒ±yrƒ±ldƒ±n!", aiScenPoliceRun: "Polisd…ôn qa√ßdƒ±n!", aiScenPoliceEarly: "S…ôbirli ol!", aiScenPoliceOk: "Yolun a√ßƒ±qdƒ±r!"
                }
            },
            en: { 
                code: 'en', flag: 'üá¨üáß', name: 'English', currency: 'USD', rate: 0.59, dir: 'ltr',
                t: {
                    regTitle: "Registration & Rules", regAttention: "ATTENTION - Rules:",
                    rule1: "Each user can register only <b>1 time</b>.",
                    rule2: "Multiple accounts from the same device will be <b>blocked</b>.",
                    rule3: "After registration, click 'Verify Payment' in 'Top Up' to get a <b>0.50 AZN</b> bonus.",
                    rule4: "You can earn by following the platform rules.",
                    rule5: "If your balance reaches zero, you must top up.",
                    regWish: "Good luck! üèÅ", phName: "Full Name", phUsername: "Username", phAge: "Age", phPass: "Password",
                    btnReg: "Complete Registration", lblLoginBal: "Current Balance:", lblScore: "High Score", btnPlay: "Start Game", btnTopup: "Top Up Balance",
                    btnDaily: "üéÅ Daily", btnAch: "üèÜ Achievements", lblScoreCombo: "Distance / Combo",
                    garBal: "Balance", lblDist: "Distance", aiTipLoad: "Advisor: Keep going!", btnMenu: "MAIN MENU",
                    goTitle: "GAME OVER", goMsgTitle: "Balance reached zero!", goMsgDesc: "Your balance is empty. You must top up to continue and earn again.",
                    btnRestart: "RESTART", btnGoTopup: "TOP UP BALANCE", btnBrake: "BRAKE",
                    tuTitle: "Top Up Balance", tuRule1: "Make a payment of min. <b>$2 USD</b> via link to top up.", tuRule2: "Once verified, the amount will be added to your balance.", tuRule3: "Playing with zero balance is strictly forbidden.",
                    btnPay: "Pay Now", btnVerify: "Verify / Claim Bonus", btnClose: "Close",
                    wdTitle: "Withdraw", wdCurBal: "Current Balance", wdPhName: "Full Name", wdPhCard: "Card/Account", wdWarn: "Balance is below minimum.", btnSubmitWd: "Submit", btnBack: "Back", garTitle: "GARAGE",
                    btnSelected: "Selected", btnSelect: "Select", btnBuy: "Buy",
                    aiScenStart: "Go go go!", aiScenEmpty: "Balance empty!", aiScenRed: "Red light fine!", aiScenGreen: "Green light bonus!", aiScenCrash: "Drive carefully!", aiScenNear: "Great dodge!", aiScenPoliceRun: "Police fine!", aiScenPoliceEarly: "Be patient!", aiScenPoliceOk: "You're clear to go!"
                }
            },
            ru: { 
                code: 'ru', flag: 'üá∑üá∫', name: '–†—É—Å—Å–∫–∏–π', currency: 'RUB', rate: 55.0, dir: 'ltr',
                t: {
                    regTitle: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ü—Ä–∞–≤–∏–ª–∞", regAttention: "–í–ù–ò–ú–ê–ù–ò–ï - –ü—Ä–∞–≤–∏–ª–∞:",
                    rule1: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∞ —Ç–æ–ª—å–∫–æ <b>1 —Ä–∞–∑</b>.",
                    rule2: "–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã –±—É–¥—É—Ç <b>–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã</b>.",
                    rule3: "–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞–∂–º–∏—Ç–µ '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É', —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å <b>0.50 AZN</b>.",
                    rule4: "–°–æ–±–ª—é–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞, —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å.",
                    rule5: "–ü—Ä–∏ –Ω—É–ª–µ–≤–æ–º –±–∞–ª–∞–Ω—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ø–æ–ª–Ω–∏—Ç—å —Å—á–µ—Ç.",
                    regWish: "–ñ–µ–ª–∞–µ–º —É–¥–∞—á–∏! üèÅ", phName: "–ò–º—è –∏ –§–∞–º–∏–ª–∏—è", phUsername: "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", phAge: "–í–æ–∑—Ä–∞—Å—Ç", phPass: "–ü–∞—Ä–æ–ª—å",
                    btnReg: "–ó–∞–≤–µ—Ä—à–∏—Ç—å", lblLoginBal: "–ë–∞–ª–∞–Ω—Å:", lblScore: "–†–µ–∫–æ—Ä–¥", btnPlay: "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É", btnTopup: "–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                    btnDaily: "üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ", btnAch: "üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è", lblScoreCombo: "–î–∏—Å—Ç–∞–Ω—Ü–∏—è / –ö–æ–º–±–æ",
                    garBal: "–ë–∞–ª–∞–Ω—Å", lblDist: "–î–∏—Å—Ç–∞–Ω—Ü–∏—è", aiTipLoad: "–°–æ–≤–µ—Ç: –í–ø–µ—Ä–µ–¥!", btnMenu: "–ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ",
                    goTitle: "–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê", goMsgTitle: "–ë–∞–ª–∞–Ω—Å –Ω–æ–ª—å!", goMsgDesc: "–í–∞—à –±–∞–ª–∞–Ω—Å –∏—Å—á–µ—Ä–ø–∞–Ω. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∏–≥—Ä—ã.",
                    btnRestart: "–ó–ê–ù–û–í–û", btnGoTopup: "–ü–û–ü–û–õ–ù–ò–¢–¨ –ë–ê–õ–ê–ù–°", btnBrake: "–¢–û–†–ú–û–ó",
                    tuTitle: "–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å", tuRule1: "–°–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–µ–≤–æ–¥ –æ—Ç <b>$2 USD</b> –ø–æ —Å—Å—ã–ª–∫–µ.", tuRule2: "–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É–º–º–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞.", tuRule3: "–ò–≥—Ä–∞ —Å –Ω—É–ª–µ–≤—ã–º –±–∞–ª–∞–Ω—Å–æ–º –∑–∞–ø—Ä–µ—â–µ–Ω–∞.",
                    btnPay: "–û–ø–ª–∞—Ç–∏—Ç—å", btnVerify: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å / –í–∑—è—Ç—å –ë–æ–Ω—É—Å", btnClose: "–ó–∞–∫—Ä—ã—Ç—å",
                    wdTitle: "–í—ã–≤–æ–¥", wdCurBal: "–ë–∞–ª–∞–Ω—Å", wdPhName: "–ò–º—è", wdPhCard: "–°—á–µ—Ç", wdWarn: "–ë–∞–ª–∞–Ω—Å –Ω–∏–∂–µ –ª–∏–º–∏—Ç–∞.", btnSubmitWd: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å", btnBack: "–ù–∞–∑–∞–¥", garTitle: "–ì–ê–†–ê–ñ",
                    btnSelected: "–í—ã–±—Ä–∞–Ω–æ", btnSelect: "–í—ã–±—Ä–∞—Ç—å", btnBuy: "–ö—É–ø–∏—Ç—å",
                    aiScenStart: "–ü–æ–≥–Ω–∞–ª–∏!", aiScenEmpty: "–ù–µ—Ç –¥–µ–Ω–µ–≥!", aiScenRed: "–®—Ç—Ä–∞—Ñ –∑–∞ –∫—Ä–∞—Å–Ω—ã–π!", aiScenGreen: "–ó–µ–ª–µ–Ω—ã–π –±–æ–Ω—É—Å!", aiScenCrash: "–û—Å—Ç–æ—Ä–æ–∂–Ω–µ–µ!", aiScenNear: "–ö—Ä—É—Ç–æ —É–≤–µ—Ä–Ω—É–ª—Å—è!", aiScenPoliceRun: "–®—Ç—Ä–∞—Ñ –ø–æ–ª–∏—Ü–∏–∏!", aiScenPoliceEarly: "–ñ–¥–∏!", aiScenPoliceOk: "–ü—É—Ç—å —Å–≤–æ–±–æ–¥–µ–Ω!"
                }
            }
        };

        const ACH_DATA = [
            { id: 'first_drive', title: 'ƒ∞lk S√ºr√º≈ü / First Drive', desc: 'Oyunu ilk d…ôf…ô oyna.', reward: 0.10 },
            { id: 'score_1000', title: 'Pe≈ü…ôkar / Pro Driver', desc: '1000 xal topla.', reward: 0.20 },
            { id: 'combo_10', title: 'Kombo Ustasƒ± / Combo Master', desc: '10x Komboya √ßat.', reward: 0.30 },
            { id: 'police_good', title: 'Qanuna Uyƒüun / Law Abiding', desc: 'Polisin …ômrin…ô tam …ôm…ôl et.', reward: 0.15 }
        ];

        const CAR_SKINS = [
            { id: 'default', name: 'Neon Blue', color: '#0ea5e9', priceAZN: 0, owned: true },
            { id: 'sport', name: 'Sport Red', color: '#f43f5e', priceAZN: 5.00, owned: false },
            { id: 'taxi', name: 'City Taxi', color: '#facc15', priceAZN: 10.00, owned: false },
            { id: 'vip', name: 'VIP Stealth', color: '#0f172a', priceAZN: 25.00, owned: false }
        ];
        const TRAFFIC_COLORS = ['#f43f5e', '#3b82f6', '#10b981', '#f59e0b', '#a855f7', '#cbd5e1', '#ea580c'];

        // T∆èHL√úK∆èSƒ∞Z LOCALSTORAGE OXUNMASI
        let currentLang = 'az'; let activeSkinId = 'default'; let balanceAZN = 0.00; 
        let isRegistered = false; let highScore = 0; let achievements = []; let lastDaily = "";
        
        try {
            currentLang = localStorage.getItem('premiumDriveLang') || 'az';
            isRegistered = localStorage.getItem('premiumDriveRegistered') === 'true';
            let sBal = localStorage.getItem('premiumDriveBalance');
            if(sBal !== null) balanceAZN = parseFloat(sBal);
            highScore = parseInt(localStorage.getItem('premiumDriveHighscore')) || 0;
            achievements = JSON.parse(localStorage.getItem('premiumDriveAchievements')) || [];
            lastDaily = localStorage.getItem('premiumDriveDaily') || "";
        } catch(e) { console.log("Yadda≈ü x…ôtasƒ±"); }

        // ==========================================
        // Dƒ∞L V∆è UI FUNKSƒ∞YALARI
        // ==========================================
        function initLanguage() {
            const langBtn = document.getElementById('langBtn');
            const langDropdown = document.getElementById('langDropdown');
            langDropdown.innerHTML = '';
            Object.values(LANGUAGES).forEach(l => {
                const opt = document.createElement('div');
                opt.className = "flex items-center gap-2 px-3 py-2 hover:bg-white/10 rounded-lg cursor-pointer transition-colors";
                opt.innerHTML = `<span>${l.flag}</span> <span class="text-xs font-bold">${l.name}</span>`;
                opt.onclick = () => { changeLanguage(l.code); langDropdown.classList.add('hidden'); };
                langDropdown.appendChild(opt);
            });
            langBtn.onclick = () => langDropdown.classList.toggle('hidden');
            changeLanguage(currentLang);
        }

        function changeLanguage(code) {
            currentLang = code;
            try { localStorage.setItem('premiumDriveLang', code); } catch(e){}
            const lang = LANGUAGES[code] || LANGUAGES['az'];
            
            document.getElementById('currentFlag').innerText = lang.flag;
            document.getElementById('currentLangName').innerText = lang.code;
            document.body.setAttribute('dir', lang.dir);
            
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (lang.t[key]) {
                    if (el.tagName === 'INPUT') el.placeholder = lang.t[key];
                    else el.innerHTML = lang.t[key];
                }
            });
            
            updateUI();
            if(!document.getElementById('garageModal').classList.contains('hidden')) renderGarage();
        }

        function formatMoney(amountAZN) {
            const lang = LANGUAGES[currentLang] || LANGUAGES['az'];
            const converted = (amountAZN * lang.rate).toFixed(2);
            if(lang.dir === 'rtl') return `${lang.currency} ${converted}`;
            return `${converted} ${lang.currency}`;
        }

        function showToast(title, amountStr, isPositive = true) {
            const toast = document.createElement('div');
            const color = isPositive ? 'bg-emerald-500/20 border-emerald-500 text-emerald-400' : 'bg-rose-500/20 border-rose-500 text-rose-400';
            toast.className = `px-4 py-2 rounded-xl border backdrop-blur-md font-bold text-sm shadow-lg transition-all duration-300 ${color}`;
            toast.innerHTML = `${title} <span class="text-white ml-2">${amountStr}</span>`;
            document.getElementById('toastContainer').appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 2000);
        }

        function checkAchievement(id) {
            if (!achievements.includes(id)) {
                achievements.push(id);
                try { localStorage.setItem('premiumDriveAchievements', JSON.stringify(achievements)); } catch(e){}
                const ach = ACH_DATA.find(a => a.id === id);
                balanceAZN += ach.reward;
                showToast(`üèÜ ${currentLang === 'az' ? 'Nailiyy…ôt' : 'Achievement'}`, `+${formatMoney(ach.reward)}`, true);
                updateUI();
            }
        }

        // ==========================================
        // EKRANLARIN QURA≈ûDIRILMASI
        // ==========================================
        function setupScreens() {
            document.getElementById('registrationScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.add('hidden');

            if (isRegistered) {
                document.getElementById('loginScreen').classList.remove('hidden');
            } else {
                document.getElementById('registrationScreen').classList.remove('hidden');
            }
            updateUI();
        }

        document.getElementById('regForm').addEventListener('submit', (e) => {
            e.preventDefault();
            try { localStorage.setItem('premiumDriveRegistered', 'true'); } catch(e){}
            if (balanceAZN === 0.00) {
                balanceAZN = 0.00; 
                try { localStorage.setItem('premiumDriveBalance', '0.00'); } catch(e){}
            }
            document.getElementById('registrationScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            updateUI();
        });

        document.getElementById('btnDaily').addEventListener('click', () => {
            const today = new Date().toDateString();
            if (lastDaily !== today) {
                lastDaily = today; 
                try { localStorage.setItem('premiumDriveDaily', today); } catch(e){}
                balanceAZN += 0.20; showToast("üéÅ", `+${formatMoney(0.20)}`, true); updateUI();
            } else {
                showToast("‚è≥", "G√∂zl…ôyin/Wait", false);
            }
        });

        document.getElementById('btnAch').addEventListener('click', () => {
            const list = document.getElementById('achList');
            list.innerHTML = '';
            ACH_DATA.forEach(a => {
                const isUnlocked = achievements.includes(a.id);
                const div = document.createElement('div');
                div.className = `p-3 rounded-xl border ${isUnlocked ? 'bg-amber-500/20 border-amber-500/50' : 'bg-slate-800 border-slate-700 opacity-50'}`;
                div.innerHTML = `<p class="font-bold text-amber-400">${a.title} ${isUnlocked ? '‚úÖ' : 'üîí'}</p>
                                 <p class="text-xs text-slate-300">+${formatMoney(a.reward)}</p>`;
                list.appendChild(div);
            });
            document.getElementById('achModal').classList.remove('hidden');
        });
        document.getElementById('closeAch').addEventListener('click', () => document.getElementById('achModal').classList.add('hidden'));

        // ==========================================
        // AUDIO & M∆èSL∆èH∆èT√áƒ∞ (Lokal)
        // ==========================================
        let audioCtx = null; 
        function initAudio() {
            try { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e) {}
        }
        function playTone(freq, type, duration, vol = 0.1) {
            try {
                if (!audioCtx) return;
                const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
                osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
                gain.gain.setValueAtTime(vol, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
                osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + duration);
            } catch(e){}
        }
        function playCrashSound() { playTone(150, 'sawtooth', 0.5, 0.4); setTimeout(() => playTone(50, 'square', 0.8, 0.4), 100); }
        function playSuccessSound() { playTone(660, 'sine', 0.1, 0.2); setTimeout(() => playTone(880, 'sine', 0.3, 0.2), 100); }
        function playFineSound() { playTone(200, 'square', 0.3, 0.3); setTimeout(() => playTone(150, 'square', 0.4, 0.3), 150); }
        function playPoliceSiren() { playTone(800, 'sine', 0.3, 0.2); setTimeout(() => playTone(600, 'sine', 0.3, 0.2), 300); }

        function getDrivingAdvice(scenarioKey) {
            const lang = LANGUAGES[currentLang] || LANGUAGES['az'];
            document.getElementById("aiTipText").innerText = lang.t[scenarioKey] || "Davam et!";
        }

        function triggerScreenShake() {
            const container = document.getElementById('gameContainer');
            container.classList.remove('shake-effect');
            void container.offsetWidth; 
            container.classList.add('shake-effect');
        }

        // ==========================================
        // OYUN M∆èNTƒ∞Qƒ∞
        // ==========================================
        const LOGICAL_WIDTH = 400; const LOGICAL_HEIGHT = 600;
        const CAR_WIDTH = 48; const CAR_HEIGHT = 86; const PLAYER_Y = LOGICAL_HEIGHT - 130;
        const LANES = [100, 200, 300]; 
        
        let isGameRunning = false; let isBraking = false; let isGameOver = false;
        let score = 0; let combo = 1; let carsPassed = 0;
        let trafficCars = []; let speedMultiplier = 1; let animatedPopups = []; 
        let nitroTimer = 0; let screenShake = 0;
        let gameState = { carX: LANES[1] - CAR_WIDTH / 2, targetX: LANES[1] - CAR_WIDTH / 2, linesOffset: 0 };
        
        let trafficLight = { active: false, y: -200, state: 'GREEN', timer: 0, passed: false };
        let policeEvent = { active: false, y: -200, state: 'APPROACHING', waitTimer: 180 };

        const canvas = document.getElementById('gameCanvas'); const ctx = canvas.getContext('2d');

        function updateUI() {
            try {
                localStorage.setItem('premiumDriveBalance', balanceAZN.toFixed(2));
                localStorage.setItem('premiumDriveHighscore', highScore.toString());
            } catch(e){}
            
            const formatted = formatMoney(balanceAZN);
            
            document.getElementById('balanceText').innerText = formatted;
            document.getElementById('loginBalanceText').innerText = formatted;
            document.getElementById('garageBalanceText').innerText = formatted;
            document.getElementById('withdrawBalanceDisplay').innerText = formatted;
            document.getElementById('scoreText').innerText = `${Math.floor(score)}`;
            document.getElementById('comboText').innerText = `x${combo}`;
            document.getElementById('loginScoreText').innerText = `${highScore} M`;
            document.getElementById('hiddenBalanceInput').value = formatted;
            
            const submitBtn = document.getElementById('submitWithdrawBtn');
            const warning = document.getElementById('withdrawWarning');
            if (balanceAZN < 30) {
                submitBtn.disabled = true; submitBtn.classList.add('opacity-50', 'cursor-not-allowed'); warning.classList.remove('hidden');
            } else {
                submitBtn.disabled = false; submitBtn.classList.remove('opacity-50', 'cursor-not-allowed'); warning.classList.add('hidden');
            }
        }

        function spawnPopup(text, color, x, y) { animatedPopups.push({ text, color, x, y, alpha: 1, life: 60 }); }

        window.selectCar = (id) => { activeSkinId = id; playSuccessSound(); renderGarage(); };
        window.buyCar = (id) => {
            const car = CAR_SKINS.find(c => c.id === id);
            if (car && balanceAZN >= car.priceAZN) {
                balanceAZN -= car.priceAZN; car.owned = true; activeSkinId = id;
                playSuccessSound(); updateUI(); renderGarage();
            }
        };

        function renderGarage() {
            const list = document.getElementById('garageList'); list.innerHTML = '';
            const lang = LANGUAGES[currentLang] || LANGUAGES['az'];
            CAR_SKINS.forEach(car => {
                const item = document.createElement('div'); item.className = "glass-panel p-4 rounded-[20px] flex items-center justify-between";
                const isSelected = activeSkinId === car.id; let btnHTML = '';
                if (car.owned) {
                    btnHTML = isSelected ? `<button disabled class="py-2 px-4 rounded-xl text-xs font-bold bg-cyan-500/10 text-cyan-500">${lang.t.btnSelected}</button>` 
                    : `<button onclick="window.selectCar('${car.id}')" class="py-2 px-4 rounded-xl text-xs font-bold bg-cyan-500/20 text-cyan-300">${lang.t.btnSelect}</button>`;
                } else {
                    const priceF = formatMoney(car.priceAZN);
                    btnHTML = balanceAZN >= car.priceAZN ? `<button onclick="window.buyCar('${car.id}')" class="py-2 px-4 rounded-xl text-xs font-bold bg-emerald-500/20 text-emerald-400">${lang.t.btnBuy} (${priceF})</button>`
                    : `<button disabled class="py-2 px-4 rounded-xl text-xs font-bold bg-slate-800/50 text-slate-500">${lang.t.btnBuy} (${priceF})</button>`;
                }
                item.innerHTML = `<div class="flex items-center gap-4"><div class="w-12 h-12 rounded-xl flex items-center justify-center" style="background-color: ${car.color}"><div class="w-6 h-10 bg-black/20"></div></div><div><p class="font-bold text-sm text-left">${car.name}</p></div></div><div>${btnHTML}</div>`;
                list.appendChild(item);
            });
        }

        function startGame() {
            if (balanceAZN <= 0) {
                document.getElementById('topUpModal').classList.remove('hidden');
                getDrivingAdvice("aiScenEmpty");
                return;
            }

            document.getElementById('loginScreen').classList.add('hidden'); 
            document.getElementById('gameScreen').classList.remove('hidden'); 
            document.getElementById('gameOverScreen').classList.add('hidden');
            
            initAudio(); 
            isGameRunning = true; isGameOver = false; isBraking = false;
            score = 0; combo = 1; carsPassed = 0; speedMultiplier = 1; trafficCars = []; animatedPopups = [];
            nitroTimer = 0; screenShake = 0;
            gameState.carX = LANES[1] - CAR_WIDTH / 2; gameState.targetX = LANES[1] - CAR_WIDTH / 2; 
            trafficLight.active = false; policeEvent.active = false;
            
            checkAchievement('first_drive');
            updateUI(); 
            getDrivingAdvice("aiScenStart"); 
            requestAnimationFrame(gameLoop);
        }

        function gameOver() {
            isGameOver = true; isGameRunning = false; 
            
            if (score > highScore) { highScore = Math.floor(score); }
            
            document.getElementById('gameOverScreen').classList.remove('hidden'); 
            document.getElementById('finalScore').innerText = Math.floor(score);
            
            const restartBtn = document.getElementById('restartBtn');
            const topupBtn = document.getElementById('gameOverTopupBtn');
            const msg = document.getElementById('gameOverMessage');
            
            if (balanceAZN <= 0) {
                restartBtn.classList.add('hidden'); topupBtn.classList.remove('hidden'); msg.classList.remove('hidden');
            } else {
                restartBtn.classList.remove('hidden'); topupBtn.classList.add('hidden'); msg.classList.add('hidden');
            }
            updateUI();
        }

        document.getElementById('btnGoMenu').addEventListener('click', () => {
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        });

        function checkBankruptcy() {
            if (balanceAZN <= 0) { balanceAZN = 0; updateUI(); gameOver(); return true; }
            return false;
        }

        function update() {
            if (!isGameRunning || isGameOver) return;
            
            let currentBaseSpeed = 5;
            if (nitroTimer > 0) { currentBaseSpeed += 6; nitroTimer--; }

            const baseSpeed = isBraking ? 0 : currentBaseSpeed * speedMultiplier; 
            if (!isBraking) { 
                score += (0.1 * combo * speedMultiplier); 
                if (speedMultiplier < 2) speedMultiplier += 0.0005;
            } 
            gameState.linesOffset = (gameState.linesOffset + baseSpeed) % 80; gameState.carX += (gameState.targetX - gameState.carX) * 0.15;

            if (screenShake > 0) screenShake--;
            if (score > 1000) checkAchievement('score_1000');

            // ƒ∞≈ûIQFOR
            if (!trafficLight.active && !policeEvent.active && Math.random() < 0.003 && score > 50) { 
                trafficLight.active = true; trafficLight.y = -100; trafficLight.passed = false; trafficLight.timer = 250; trafficLight.state = 'GREEN'; 
            }
            if (trafficLight.active) {
                trafficLight.y += baseSpeed; trafficLight.timer--;
                if (trafficLight.timer === 180) trafficLight.state = 'YELLOW';
                if (trafficLight.timer === 100) trafficLight.state = 'RED';
                if (trafficLight.timer === 0) trafficLight.state = 'GREEN';

                if (trafficLight.y > PLAYER_Y + CAR_HEIGHT && !trafficLight.passed) {
                    trafficLight.passed = true;
                    if (trafficLight.state === 'RED' && !isBraking) { 
                        balanceAZN -= 0.60; combo = 1; playFineSound(); screenShake = 15;
                        spawnPopup("- " + formatMoney(0.60), "#f43f5e", gameState.carX + CAR_WIDTH/2, PLAYER_Y - 20); 
                        if (checkBankruptcy()) return; getDrivingAdvice("aiScenRed"); 
                    } else if (trafficLight.state === 'GREEN') { 
                        balanceAZN += 0.40; nitroTimer = 60; playSuccessSound(); 
                        spawnPopup("üöÄ + " + formatMoney(0.40), "#10b981", gameState.carX + CAR_WIDTH/2, PLAYER_Y - 20); 
                        getDrivingAdvice("aiScenGreen");
                    }
                    updateUI(); 
                }
                if (trafficLight.y > LOGICAL_HEIGHT) trafficLight.active = false;
            }

            // POLƒ∞S
            if (!policeEvent.active && !trafficLight.active && Math.random() < 0.002 && score > 150) {
                policeEvent = { active: true, y: -200, state: 'APPROACHING', waitTimer: 180 }; playPoliceSiren();
            }
            if (policeEvent.active) {
                if (policeEvent.state === 'APPROACHING') {
                    policeEvent.y += baseSpeed + 2;
                    if (policeEvent.y > PLAYER_Y - 30) {
                        if (!isBraking) {
                            balanceAZN -= 0.60; combo = 1; playFineSound(); screenShake = 20;
                            spawnPopup("üöì - " + formatMoney(0.60), "#f43f5e", LOGICAL_WIDTH/2, PLAYER_Y - 30);
                            if (checkBankruptcy()) return;
                            getDrivingAdvice("aiScenPoliceRun"); policeEvent.state = 'PASSED';
                        } else {
                            policeEvent.state = 'WAITING'; policeEvent.y = PLAYER_Y - 30;
                        }
                        updateUI();
                    }
                } else if (policeEvent.state === 'WAITING') {
                    policeEvent.y = PLAYER_Y - 30; 
                    if (!isBraking) {
                        balanceAZN -= 0.60; combo = 1; playFineSound(); screenShake = 20;
                        spawnPopup("‚ùå - " + formatMoney(0.60), "#f43f5e", LOGICAL_WIDTH/2, PLAYER_Y - 30);
                        if (checkBankruptcy()) return;
                        getDrivingAdvice("aiScenPoliceEarly"); policeEvent.state = 'PASSED'; updateUI();
                    } else {
                        policeEvent.waitTimer--;
                        if (policeEvent.waitTimer <= 0) {
                            policeEvent.state = 'GO'; balanceAZN += 0.30; playSuccessSound(); checkAchievement('police_good');
                            spawnPopup("‚úÖ + " + formatMoney(0.30), "#10b981", LOGICAL_WIDTH/2, PLAYER_Y - 30);
                            getDrivingAdvice("aiScenPoliceOk"); updateUI();
                        }
                    }
                } else if (policeEvent.state === 'GO' || policeEvent.state === 'PASSED') {
                    policeEvent.y += baseSpeed;
                    if (policeEvent.y > LOGICAL_HEIGHT) policeEvent.active = false;
                }
            }

            // TRAFƒ∞K
            const safeToSpawn = !(policeEvent.active && policeEvent.state === 'WAITING') && !(trafficLight.active && trafficLight.state === 'RED');

            if (safeToSpawn && Math.random() < 0.015 * speedMultiplier && !isBraking) {
                const lane = LANES[Math.floor(Math.random() * LANES.length)];
                if (trafficCars.every(c => Math.abs(c.x - (lane - CAR_WIDTH/2)) > 10 || c.y > 150)) {
                    let cColor = TRAFFIC_COLORS[Math.floor(Math.random() * TRAFFIC_COLORS.length)];
                    let isTruck = Math.random() > 0.8; 
                    trafficCars.push({ 
                        x: lane - CAR_WIDTH / 2, y: -150, speed: Math.random() * 2 + 1, 
                        color: cColor, type: isTruck ? 'truck' : 'car', height: isTruck ? 130 : CAR_HEIGHT,
                        passed: false, crashed: false 
                    });
                }
            }

            for (let i = trafficCars.length - 1; i >= 0; i--) {
                let car = trafficCars[i]; car.y += baseSpeed + (isBraking ? car.speed * 2 : car.speed - 3); 
                
                // Q…ôza 
                if (!car.crashed && Math.abs(gameState.carX - car.x) < CAR_WIDTH - 10 && PLAYER_Y < car.y + car.height - 10 && PLAYER_Y + CAR_HEIGHT - 10 > car.y) {
                    balanceAZN -= 0.10; combo = 1; playCrashSound(); screenShake = 20;
                    spawnPopup("- " + formatMoney(0.10), "#f43f5e", gameState.carX + CAR_WIDTH/2, PLAYER_Y); 
                    car.crashed = true; trafficCars.splice(i, 1); 
                    if (checkBankruptcy()) return; getDrivingAdvice("aiScenCrash"); updateUI(); 
                } 
                // Kombo (Pass)
                else if (!car.crashed && !car.passed && car.y > PLAYER_Y + CAR_HEIGHT) {
                    car.passed = true; carsPassed++;
                    if (carsPassed % 5 === 0) { combo++; if (combo >= 10) checkAchievement('combo_10'); }
                    updateUI();
                }
                // T…ôhl√ºk…ôli ke√ßi≈ü (Near miss)
                else if (!car.crashed && !car.passed && car.y > PLAYER_Y - car.height && car.y < PLAYER_Y + CAR_HEIGHT) {
                    if (Math.abs((gameState.carX + CAR_WIDTH/2) - (car.x + CAR_WIDTH/2)) < CAR_WIDTH + 15) {
                        car.passed = true; balanceAZN += 0.05; playTone(800, 'sine', 0.1, 0.1); 
                        spawnPopup("‚ö° + " + formatMoney(0.05), "#facc15", gameState.carX + CAR_WIDTH/2, PLAYER_Y - 20); updateUI();
                        getDrivingAdvice("aiScenNear");
                    }
                }
                
                if (car.y > LOGICAL_HEIGHT) { trafficCars.splice(i, 1); }
            }

            animatedPopups.forEach(p => { p.y -= (nitroTimer > 0 ? 3 : 1.5); p.alpha -= 0.015; p.life--; }); 
            animatedPopups = animatedPopups.filter(p => p.life > 0);
        }

        // T∆èHL√úK∆èSƒ∞Z √áƒ∞Zƒ∞M METODU
        function drawCar(x, y, color, isPlayer, braking, type = 'car', h = CAR_HEIGHT) {
            ctx.save(); ctx.fillStyle = color; 
            drawRoundedRect(ctx, x, y, CAR_WIDTH, h, 8);
            
            ctx.fillStyle = '#020617'; 
            if (type === 'truck') {
                ctx.fillRect(x + 4, y + 5, CAR_WIDTH - 8, 15);
                ctx.fillStyle = 'rgba(0,0,0,0.5)';
                ctx.fillRect(x + 2, y + 25, CAR_WIDTH - 4, h - 30);
            } else {
                ctx.fillRect(x + 4, y + 15, CAR_WIDTH - 8, 18); 
                ctx.fillRect(x + 6, y + h - 25, CAR_WIDTH - 12, 12); 
            }

            if (isPlayer && braking) { ctx.fillStyle = '#f43f5e'; ctx.fillRect(x + 4, y + h - 6, 12, 4); ctx.fillRect(x + CAR_WIDTH - 16, y + h - 6, 12, 4); } 
            else if (!isPlayer && type !== 'truck') { ctx.fillStyle = '#fef08a'; ctx.fillRect(x + 6, y + 2, 8, 4); ctx.fillRect(x + CAR_WIDTH - 14, y + 2, 8, 4); }
            
            if (type === 'police') {
                ctx.fillStyle = Date.now() % 400 < 200 ? '#f43f5e' : '#3b82f6';
                ctx.fillRect(x + 10, y + 25, CAR_WIDTH - 20, 6);
            }

            if (isPlayer && nitroTimer > 0) {
                ctx.fillStyle = 'rgba(34, 211, 238, 0.5)';
                ctx.fillRect(x + 10, y + h, CAR_WIDTH - 20, 40);
            }
            ctx.restore();
        }

        function draw() {
            if (!ctx) return; 
            ctx.save();
            if (screenShake > 0) { ctx.translate(Math.random() * 10 - 5, Math.random() * 10 - 5); }

            ctx.fillStyle = '#020617'; ctx.fillRect(0, 0, LOGICAL_WIDTH, LOGICAL_HEIGHT); 
            ctx.fillStyle = '#1e293b'; ctx.fillRect(40, 0, 15, LOGICAL_HEIGHT); ctx.fillRect(LOGICAL_WIDTH - 55, 0, 15, LOGICAL_HEIGHT); 
            ctx.fillStyle = '#0f172a'; ctx.fillRect(55, 0, LOGICAL_WIDTH - 110, LOGICAL_HEIGHT);
            
            let dashLength = nitroTimer > 0 ? 60 : 40;
            ctx.setLineDash([dashLength, 40]); ctx.strokeStyle = nitroTimer > 0 ? 'rgba(34, 211, 238, 0.4)' : 'rgba(255,255,255,0.2)'; ctx.lineWidth = 4; ctx.lineDashOffset = -gameState.linesOffset; ctx.beginPath(); ctx.moveTo(150, 0); ctx.lineTo(150, LOGICAL_HEIGHT); ctx.moveTo(250, 0); ctx.lineTo(250, LOGICAL_HEIGHT); ctx.stroke();

            if (trafficLight.active) {
                ctx.fillStyle = 'rgba(255,255,255,0.8)'; ctx.fillRect(55, trafficLight.y, LOGICAL_WIDTH - 110, 10); ctx.fillStyle = '#1e293b'; 
                drawRoundedRect(ctx, LOGICAL_WIDTH - 50, trafficLight.y - 80, 30, 90, 8);
                const drawLight = (yOff, color, active) => { ctx.fillStyle = active ? color : '#020617'; ctx.beginPath(); ctx.arc(LOGICAL_WIDTH - 35, trafficLight.y - 80 + yOff, 10, 0, Math.PI*2); ctx.fill(); };
                drawLight(20, '#f43f5e', trafficLight.state === 'RED'); drawLight(45, '#facc15', trafficLight.state === 'YELLOW'); drawLight(70, '#10b981', trafficLight.state === 'GREEN');
            }

            if (policeEvent.active) {
                let px = LOGICAL_WIDTH - 55;
                drawCar(px, policeEvent.y, '#ffffff', false, false, 'police');
                
                ctx.font = '900 24px sans-serif'; ctx.textAlign = 'right';
                let stopTxt = "üõë SAXLA!"; let goTxt = "‚úÖ GET!";
                if(currentLang==='en'){ stopTxt="üõë STOP!"; goTxt="‚úÖ GO!"; } else if(currentLang==='ru'){ stopTxt="üõë –°–¢–û–ü!"; goTxt="‚úÖ –ï–î–¨!"; } else if(currentLang==='tr'){ stopTxt="üõë DUR!"; goTxt="‚úÖ Gƒ∞T!"; }
                
                if (policeEvent.state === 'APPROACHING' || policeEvent.state === 'WAITING') { ctx.fillStyle = '#f43f5e'; ctx.fillText(stopTxt, px - 10, policeEvent.y + CAR_HEIGHT / 2); } 
                else if (policeEvent.state === 'GO') { ctx.fillStyle = '#10b981'; ctx.fillText(goTxt, px - 10, policeEvent.y + CAR_HEIGHT / 2); }
            }

            trafficCars.forEach(car => drawCar(car.x, car.y, car.color, false, false, car.type, car.height));
            drawCar(gameState.carX, PLAYER_Y, CAR_SKINS.find(c => c.id === activeSkinId).color, true, isBraking); 

            animatedPopups.forEach(p => { ctx.fillStyle = p.color; ctx.globalAlpha = Math.max(0, p.alpha); ctx.font = '900 24px sans-serif'; ctx.textAlign = 'center'; ctx.fillText(p.text, p.x, p.y); ctx.globalAlpha = 1; });
            
            ctx.restore();
        }

        function gameLoop() { update(); draw(); if (isGameRunning) requestAnimationFrame(gameLoop); }

        // ==========================================
        // D√úYM∆èL∆èR V∆è EVENTL∆èR
        // ==========================================
        document.getElementById('loginBtn').addEventListener('click', startGame);
        document.getElementById('restartBtn').addEventListener('click', startGame);
        
        document.getElementById('gameOverTopupBtn').addEventListener('click', () => { document.getElementById('gameOverScreen').classList.add('hidden'); document.getElementById('topUpModal').classList.remove('hidden'); });
        document.getElementById('buyMeCoffeeBtn').addEventListener('click', () => { window.open('https://buymeacoffee.com/surwin', '_blank'); });

        // √ñD∆èNƒ∞≈ûƒ∞ YOXLA - (Demo test √º√ß√ºn 3 AZN / 0.50 AZN m…ôntiqi)
        document.getElementById('verifyPaymentBtn').addEventListener('click', (e) => {
            const btn = e.currentTarget; btn.innerHTML = `‚è≥ ...`; btn.disabled = true;
            setTimeout(() => {
                let bonusClaimed = localStorage.getItem('premiumDriveBonusClaimed') === 'true';
                if (!bonusClaimed) {
                    balanceAZN += 0.50; localStorage.setItem('premiumDriveBonusClaimed', 'true'); updateUI(); playSuccessSound();
                    btn.innerHTML = `‚úÖ + ${formatMoney(0.50)}`; btn.classList.replace('text-emerald-400', 'text-white'); btn.classList.replace('bg-emerald-500/10', 'bg-emerald-600');
                    setTimeout(() => { document.getElementById('topUpModal').classList.add('hidden'); btn.innerHTML = `üîÑ ${LANGUAGES[currentLang].t.btnVerify}`; btn.disabled = false; btn.classList.replace('text-white', 'text-emerald-400'); btn.classList.replace('bg-emerald-600', 'bg-emerald-500/10'); }, 2000);
                } else {
                    // TEST M∆èQS∆èDƒ∞ ƒ∞L∆è DAHA SONRA 3 AZN ∆èLAV∆è EDƒ∞R (Realda backend olmalƒ±dƒ±r)
                    balanceAZN += 3.00; updateUI(); playSuccessSound();
                    btn.innerHTML = `‚úÖ + ${formatMoney(3.00)}`; btn.classList.replace('text-emerald-400', 'text-white'); btn.classList.replace('bg-emerald-500/10', 'bg-emerald-600');
                    setTimeout(() => { document.getElementById('topUpModal').classList.add('hidden'); btn.innerHTML = `üîÑ ${LANGUAGES[currentLang].t.btnVerify}`; btn.disabled = false; btn.classList.replace('text-white', 'text-emerald-400'); btn.classList.replace('bg-emerald-600', 'bg-emerald-500/10'); }, 2000);
                }
            }, 1500);
        });

        const toggleModal = (btnId, modalId, show) => document.getElementById(btnId).addEventListener('click', () => { document.getElementById(modalId).classList[show ? 'remove' : 'add']('hidden'); updateUI(); if(show && modalId==='garageModal') renderGarage(); });
        toggleModal('loginTopupBtn', 'topUpModal', true); toggleModal('topupBtn', 'topUpModal', true); toggleModal('closeTopUpBtn', 'topUpModal', false);
        toggleModal('withdrawBtn', 'withdrawModal', true); toggleModal('closeWithdrawBtn', 'withdrawModal', false);
        toggleModal('garageBtn', 'garageModal', true); toggleModal('closeGarageBtn', 'garageModal', false);

        const brakeBtn = document.getElementById('brakeBtn');
        const startBraking = (e) => { e.preventDefault(); isBraking = true; }; const stopBraking = (e) => { e.preventDefault(); isBraking = false; combo = 1; updateUI(); };
        brakeBtn.addEventListener('mousedown', startBraking); brakeBtn.addEventListener('mouseup', stopBraking); brakeBtn.addEventListener('touchstart', startBraking, {passive: false}); brakeBtn.addEventListener('touchend', stopBraking, {passive: false});
        
        const goLeft = (e) => { e.preventDefault(); if(gameState.targetX > LANES[0] - CAR_WIDTH/2) gameState.targetX -= 100; };
        const goRight = (e) => { e.preventDefault(); if(gameState.targetX < LANES[2] - CAR_WIDTH/2) gameState.targetX += 100; };
        document.getElementById('laneLeft').addEventListener('mousedown', goLeft); document.getElementById('laneLeft').addEventListener('touchstart', goLeft, {passive: false});
        document.getElementById('laneRight').addEventListener('mousedown', goRight); document.getElementById('laneRight').addEventListener('touchstart', goRight, {passive: false});

        // BA≈ûLANƒûIC QURA≈ûDIRMA
        try { initLanguage(); setupScreens(); } catch(e) {}

    </script>
</body>
</html>
