<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sürücü Oyunu</title>

<style>
body{
margin:0;
font-family:Arial;
background:linear-gradient(#1a1a1a,#000);
color:white;
text-align:center;
}
.hidden{display:none;}
input,button{
padding:8px;
margin:5px;
border:none;
border-radius:6px;
}
button{
background:#00aa55;
color:white;
cursor:pointer;
}
button:hover{background:#00cc66;}
.topbar{
display:flex;
justify-content:space-around;
background:#111;
padding:10px;
font-size:14px;
}
canvas{
background:#444;
display:block;
margin:15px auto;
border:3px solid #00aa55;
}
#chatBox{
width:320px;
margin:10px auto;
background:#222;
padding:10px;
border-radius:10px;
}
#chatMessages{
height:120px;
overflow-y:auto;
text-align:left;
font-size:12px;
margin-bottom:5px;
}
</style>
</head>

<body>

<div id="auth">
<h2>Qeydiyyat / Giriş</h2>
<input type="text" id="username" placeholder="İstifadəçi adı">
<input type="password" id="password" placeholder="Şifrə">
<br>
<button onclick="register()">Qeydiyyat</button>
<button onclick="login()">Giriş</button>
</div>

<div id="dashboard" class="hidden">
<div class="topbar">
<span id="welcome"></span>
<span>Balans: <b id="balance">0</b> AZN</span>
<span>Sürət: <b id="speed">0</b> km/h</span>
<span>Məsafə: <b id="distance">0</b> m</span>
<button onclick="logout()">Çıxış</button>
</div>

<div>
<button onclick="startGame()">Oyuna Başla (0.20 AZN)</button>
<input type="number" id="addAmount" placeholder="Balans artır (min 5)">
<button onclick="addBalance()">Balansı artır</button>
</div>

<canvas id="game" width="400" height="600"></canvas>

<div id="chatBox">
<div id="chatMessages"></div>
<input type="text" id="chatInput" placeholder="Mesaj yaz...">
<button onclick="sendMessage()">Göndər</button>
</div>
</div>

<script>
let currentUser=null;
let balance=0;
let speed=0;
let distance=0;
let gameInterval;
let redLight=true;
let redTimer=10;

const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

let car={x:180,y:500,width:40,height:70};

window.onload=function(){
if(localStorage.getItem("activeUser")){
currentUser=localStorage.getItem("activeUser");
balance=parseFloat(localStorage.getItem(currentUser+"_balance"))||0;
showDashboard();
}
}

function register(){
let u=username.value;
let p=password.value;
if(localStorage.getItem(u)){
alert("Bu istifadəçi artıq mövcuddur!");
return;
}
localStorage.setItem(u,p);
localStorage.setItem(u+"_balance",0);
alert("Qeydiyyat uğurlu!");
}

function login(){
let u=username.value;
let p=password.value;
if(localStorage.getItem(u)===p){
currentUser=u;
localStorage.setItem("activeUser",u);
balance=parseFloat(localStorage.getItem(u+"_balance"))||0;
showDashboard();
}else{
alert("Yanlış məlumat!");
}
}

function logout(){
localStorage.removeItem("activeUser");
location.reload();
}

function showDashboard(){
auth.classList.add("hidden");
dashboard.classList.remove("hidden");
welcome.innerText="Xoş gəldin, "+currentUser;
updateUI();
}

function addBalance(){
let amount=parseFloat(addAmount.value);
if(amount>=5){
balance+=amount;
saveBalance();
}else{
alert("Minimum 5 AZN artırmaq lazımdır!");
}
}

function saveBalance(){
localStorage.setItem(currentUser+"_balance",balance);
updateUI();
}

function updateUI(){
balanceElement=document.getElementById("balance");
balanceElement.innerText=balance.toFixed(2);
document.getElementById("speed").innerText=speed;
document.getElementById("distance").innerText=Math.floor(distance);
}

function startGame(){
if(balance<0.20){
alert("Balans kifayət deyil!");
return;
}
balance-=0.20;
saveBalance();
speed=0;
distance=0;
gameInterval=setInterval(gameLoop,100);
}

function gameLoop(){
ctx.clearRect(0,0,400,600);

speed+=2;
if(speed>60){
balance-=0.5;
}

distance+=speed/5;

// Draw car
ctx.fillStyle="white";
ctx.fillRect(car.x,car.y,car.width,car.height);

// Traffic light timer
redTimer-=0.1;
if(redTimer<=0){
redLight=!redLight;
redTimer=redLight?10:10;
}

if(redLight){
ctx.fillStyle="red";
}else{
ctx.fillStyle="green";
}
ctx.fillRect(180,50,40,40);

if(redLight && car.y<120){
balance-=1;
alert("Qırmızı işıqda keçdin! -1 AZN");
car.y=500;
}

updateUI();

if(balance<=0){
clearInterval(gameInterval);
alert("Oyun bitdi!");
}
}

document.addEventListener("keydown",function(e){
if(e.key==="ArrowLeft") car.x-=15;
if(e.key==="ArrowRight") car.x+=15;
if(e.key==="ArrowUp") car.y-=15;
if(e.key==="ArrowDown") car.y+=15;
});

// CHAT SYSTEM
function sendMessage(){
let msg=chatInput.value.toLowerCase();
addChat("Sən: "+msg);

if(msg.includes("balans")){
addChat("Bot: Balansı artır bölməsinə daxil olub minimum 5 AZN əlavə et.");
}else if(msg.includes("qayda")){
addChat("Bot: Qırmızı işıqda dayan və 60 km/saatdan sürətli getmə.");
}else{
addChat("Bot: Əla sürüş! Sən artıq peşəkar sürücüsən!");
}
chatInput.value="";
}

function addChat(text){
let div=document.createElement("div");
div.innerText=text;
chatMessages.appendChild(div);
}

setInterval(()=>{
addChat("Bot: Qırmızı işıqda dayanmağı unutma!");
},30000);
</script>

</body>
</html>
