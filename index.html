<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S√ºr√ºc√ºl√ºk Akademiyasƒ± - Qaydalara Uƒü, Qazan!</title>
    <style>
        body { background-color: #1a1a2e; color: #ffffff; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        .top-bar { position: absolute; top: 15px; width: 90%; display: flex; justify-content: space-between; align-items: flex-start; z-index: 10; }
        .ui-panel { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px); border: 1px solid #00ff88; padding: 15px 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 255, 136, 0.2); }
        .balance-text { font-size: 24px; font-weight: bold; color: #00ff88; margin: 0;}
        .info-text { font-size: 14px; color: #ccc; margin-top: 5px; }

        .action-buttons button { background: rgba(0, 0, 0, 0.6); color: white; border: 1px solid rgba(255, 255, 255, 0.3); padding: 10px 15px; border-radius: 8px; cursor: pointer; margin-left: 10px; font-weight: bold; transition: 0.3s; }
        .action-buttons button:hover { background: #00ff88; color: black; }
        .garage-btn { background: linear-gradient(45deg, #f1c40f, #e67e22) !important; color: #111 !important; border: none !important;}

        /* Canvas-ƒ± bir az da geni≈ül…ôtdik ki, m…ônz…ôr…ô g√∂r√ºns√ºn */
        canvas { background-color: #2ecc71; margin-top: 90px; border-radius: 10px; box-shadow: 0 0 40px rgba(0, 0, 0, 0.9); border: 4px solid #111; transition: background-color 2s ease;}

        .controls { position: absolute; bottom: 20px; z-index: 10; width: 100%; display: flex; justify-content: center;}
        .brake-btn { background: linear-gradient(135deg, #ff3333, #cc0000); color: white; border: 2px solid #fff; padding: 15px 60px; font-size: 24px; font-weight: bold; border-radius: 50px; cursor: pointer; box-shadow: 0 10px 20px rgba(255, 51, 51, 0.6); text-transform: uppercase; letter-spacing: 2px; }
        .brake-btn:active { transform: scale(0.95); }
        
        #message { position: absolute; top: 40%; font-size: 40px; font-weight: bold; text-shadow: 2px 2px 10px #000; opacity: 0; transition: opacity 0.5s; z-index: 20; pointer-events: none; text-align: center;}

        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 200; justify-content: center; align-items: center; }
        .modal-content { background: #1a1a2e; border: 1px solid #00ff88; padding: 30px; border-radius: 15px; max-width: 400px; width: 90%; text-align: left; }
        .close-btn { background: #ff3333; padding: 12px 20px; border: none; border-radius: 8px; color: white; cursor: pointer; margin-top: 20px; width: 100%; font-weight: bold; font-size: 16px;}
        
        .car-item { display: flex; justify-content: space-between; align-items: center; background: #2c3e50; padding: 15px; margin-bottom: 10px; border-radius: 10px; border: 1px solid #34495e; }
        .car-info { display: flex; align-items: center; font-weight: bold;}
        .car-color-box { width: 40px; height: 20px; border-radius: 4px; display: inline-block; margin-right: 15px; border: 1px solid #fff;}
        .car-action-btn { background: #00ff88; color: #111; border: none; padding: 8px 15px; border-radius: 5px; font-weight: bold; cursor: pointer;}
        .car-action-btn:disabled { background: #555; color: #aaa; cursor: not-allowed;}
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="ui-panel">
            <div class="balance-text">Bakiy…ô: <span id="balance">100</span> ‚Çº</div>
            <div class="info-text" id="biomeText">M…ônz…ôr…ô: Ya≈üƒ±l Me≈ü…ô</div>
        </div>
        <div class="action-buttons">
            <button class="garage-btn" onclick="openGarage()">üõí Qaraj</button>
            <button onclick="addBalance()">+ Y√ºkl…ô</button>
        </div>
    </div>

    <div id="garageModal" class="modal-overlay">
        <div class="modal-content">
            <h2 style="color:#00ff88; margin-top:0;">üõí Qaraj (Maƒüaza)</h2>
            <div id="garageList"></div>
            <button class="close-btn" onclick="closeGarage()">Qarajdan √áƒ±x v…ô Oyna</button>
        </div>
    </div>

    <div id="message"></div>
    <canvas id="gameCanvas" width="500" height="550"></canvas>

    <div class="controls">
        <button class="brake-btn" id="brakeBtn">Tormoz Ver!</button>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const balanceUI = document.getElementById("balance");
        const messageUI = document.getElementById("message");
        const biomeTextUI = document.getElementById("biomeText");
        
        let balance = 100;
        let gamePaused = false; 

        // --- QARAJ ---
        let availableCars = [
            { name: "Klassik Mavi", color: "#3498db", price: 0, owned: true },
            { name: "Qƒ±rmƒ±zƒ± Sport", color: "#e74c3c", price: 150, owned: false },
            { name: "Sarƒ± Taksi", color: "#f1c40f", price: 300, owned: false },
            { name: "Qara Pantera", color: "#222222", price: 500, owned: false }
        ];
        let currentCarIndex = 0;

        function openGarage() { document.getElementById("garageModal").style.display = "flex"; gamePaused = true; renderGarage(); }
        function closeGarage() { document.getElementById("garageModal").style.display = "none"; gamePaused = false; }
        function renderGarage() {
            let html = "";
            availableCars.forEach((c, index) => {
                let btnHtml = c.owned 
                    ? (currentCarIndex === index ? `<button class="car-action-btn" disabled>Se√ßilib</button>` : `<button class="car-action-btn" onclick="selectCar(${index})">Se√ß</button>`)
                    : `<button class="car-action-btn" onclick="buyCar(${index})">Al: ${c.price} ‚Çº</button>`;
                html += `<div class="car-item"><div class="car-info"><span class="car-color-box" style="background-color: ${c.color}"></span>${c.name}</div>${btnHtml}</div>`;
            });
            document.getElementById("garageList").innerHTML = html;
        }
        function buyCar(index) {
            if (balance >= availableCars[index].price) {
                balance -= availableCars[index].price; balanceUI.innerText = balance;
                availableCars[index].owned = true; selectCar(index); showMessage("M√ºbar…ôkdir!", "#f1c40f");
            } else alert("Kifay…ôt q…ôd…ôr bakiy…ôn yoxdur!");
        }
        function selectCar(index) { currentCarIndex = index; car.color = availableCars[index].color; renderGarage(); }
        function addBalance() {
            let mebleg = prompt("Y√ºkl…ôm…ôk ist…ôdiyiniz m…ôbl…ôƒüi daxil edin:");
            if (mebleg && !isNaN(mebleg) && parseInt(mebleg) > 0) { balance += parseInt(mebleg); balanceUI.innerText = balance; showMessage("+" + mebleg + " ‚Çº", "#00ff88"); }
        }
        function showMessage(text, color) {
            messageUI.innerText = text; messageUI.style.color = color;
            messageUI.style.opacity = 1; setTimeout(() => messageUI.style.opacity = 0, 2000);
        }

        // --- OYUN M∆èNTƒ∞Qƒ∞ V∆è M∆èNZ∆èR∆è ---
        const brakeBtn = document.getElementById("brakeBtn");
        let isBraking = false;
        let gameSpeed = 4.5;
        let linesOffset = 0;
        let totalDistance = 0;
        
        // M…ônz…ôr…ô (Biyom) Sistemi
        let biomes = [
            { name: "Ya≈üƒ±l Me≈ü…ô", ground: "#2ecc71", element: "#27ae60" }, // Ya≈üƒ±l
            { name: "Sarƒ± S…ôhra", ground: "#f39c12", element: "#d35400" }, // S…ôhra
            { name: "Qarlƒ± Yol", ground: "#ecf0f1", element: "#bdc3c7" }   // Qar
        ];
        let currentBiome = 0;
        let sceneryObjects = []; // Aƒüaclar, kaktuslar v…ô s.

        // Bizim ma≈üƒ±n (Orta zolaqda - x: 225)
        let car = { x: 225, y: 430, width: 50, height: 90, color: "#3498db" };
        let trafficLight = { state: "green", timer: 0, y: 100 };
        let trafficCars = [];

        brakeBtn.addEventListener("mousedown", () => isBraking = true); brakeBtn.addEventListener("mouseup", () => isBraking = false);
        brakeBtn.addEventListener("touchstart", () => isBraking = true); brakeBtn.addEventListener("touchend", () => isBraking = false);
        document.addEventListener("keydown", (e) => { if(e.code === "Space") isBraking = true; }); document.addEventListener("keyup", (e) => { if(e.code === "Space") isBraking = false; });

        // DAHA T∆èBƒ∞ƒ∞ MA≈ûIN √á∆èKM∆è FUNKSƒ∞YASI
        function drawDetailedCar(x, y, color) {
            // T…ôk…ôrl…ôr
            ctx.fillStyle = "#111";
            ctx.fillRect(x - 4, y + 15, 6, 20); // Qabaq sol
            ctx.fillRect(x + 48, y + 15, 6, 20); // Qabaq saƒü
            ctx.fillRect(x - 4, y + 65, 6, 20); // Arxa sol
            ctx.fillRect(x + 48, y + 65, 6, 20); // Arxa saƒü

            // Ma≈üƒ±nƒ±n G√∂vd…ôsi
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.roundRect ? ctx.roundRect(x, y, 50, 95, 8) : ctx.fillRect(x, y, 50, 95); // D…ôst…ôkl…ôyirs…ô k…ônarlarƒ± yum≈üalt
            ctx.fill();

            // Qabaq v…ô Arxa ≈û√º≈ü…ôl…ôr
            ctx.fillStyle = "#1e272e"; // T√ºnd ≈ü√º≈ü…ô
            ctx.fillRect(x + 5, y + 25, 40, 20); // Qabaq
            ctx.fillRect(x + 5, y + 65, 40, 15); // Arxa

            // Tavan
            ctx.fillStyle = "rgba(0,0,0,0.15)";
            ctx.fillRect(x + 8, y + 45, 34, 20); 

            // Faralar
            ctx.fillStyle = "#fff200";
            ctx.fillRect(x + 5, y + 2, 12, 6);
            ctx.fillRect(x + 33, y + 2, 12, 6);
            
            // Arxa Stop ƒ∞≈üƒ±qlarƒ±
            ctx.fillStyle = "#ff0000";
            ctx.fillRect(x + 5, y + 87, 12, 6);
            ctx.fillRect(x + 33, y + 87, 12, 6);
        }

        function draw() {
            // Arxa fon (M…ônz…ôr…ô otluƒüu/s…ôhrasƒ±)
            canvas.style.backgroundColor = biomes[currentBiome].ground;
            ctx.clearRect(0, 0, canvas.width, canvas.height); // √úmumi t…ômizlik

            // Asfalt Yol (Ortada, eni 300px)
            ctx.fillStyle = "#34495e"; 
            ctx.fillRect(100, 0, 300, canvas.height);

            // M…ônz…ôr…ô Obyektl…ôrini (Aƒüac/Kaktus) √ß…ôkm…ôk
            sceneryObjects.forEach(obj => {
                ctx.fillStyle = obj.color;
                ctx.beginPath();
                ctx.arc(obj.x, obj.y, obj.size, 0, Math.PI * 2);
                ctx.fill();
            });

            // 3 Zolaqlƒ± Yol X…ôtl…ôri
            ctx.fillStyle = "#ffffff";
            for (let i = 0; i < 8; i++) { 
                ctx.fillRect(195, i * 100 + linesOffset - 100, 6, 40); // Sol x…ôtt
                ctx.fillRect(295, i * 100 + linesOffset - 100, 6, 40); // Saƒü x…ôtt
            }
            
            // Yolun k…ônar sarƒ± x…ôtl…ôri
            ctx.fillStyle = "#f1c40f";
            ctx.fillRect(100, 0, 4, canvas.height);
            ctx.fillRect(396, 0, 4, canvas.height);

            // Stop x…ôtti
            ctx.fillStyle = "#ecf0f1"; ctx.fillRect(90, 150, 320, 10); 

            // ƒ∞≈üƒ±qfor
            ctx.fillStyle = "#111"; ctx.fillRect(420, 30, 50, 110);
            ctx.fillStyle = trafficLight.state === "red" ? "#ff3333" : "#550000"; ctx.beginPath(); ctx.arc(445, 55, 12, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = trafficLight.state === "yellow" ? "#f1c40f" : "#555500"; ctx.beginPath(); ctx.arc(445, 85, 12, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = trafficLight.state === "green" ? "#00ff88" : "#005522"; ctx.beginPath(); ctx.arc(445, 115, 12, 0, Math.PI * 2); ctx.fill();

            // Trafik Ma≈üƒ±nlarƒ±nƒ± √á…ôkm…ôk (Yeni t…ôbii dizaynla)
            trafficCars.forEach(tc => {
                drawDetailedCar(tc.x, tc.y, tc.color);
            });

            // Bizim Ma≈üƒ±nƒ±mƒ±z (Yeni t…ôbii dizaynla)
            drawDetailedCar(car.x, car.y, car.color);
        }

        function update() {
            if (gamePaused) return;

            // ƒ∞≈üƒ±qfor m…ôntiqi
            trafficLight.timer++;
            if (trafficLight.timer === 150) trafficLight.state = "yellow";
            if (trafficLight.timer === 200) trafficLight.state = "red";
            if (trafficLight.timer === 350) { trafficLight.state = "green"; trafficLight.timer = 0; }

            // M…ônz…ôr…ô (Aƒüac/Kaktus) Yaratmaq
            if (Math.random() < 0.1) {
                let isLeft = Math.random() < 0.5;
                sceneryObjects.push({
                    x: isLeft ? 20 + Math.random() * 50 : 430 + Math.random() * 50,
                    y: -50,
                    size: 15 + Math.random() * 20,
                    color: biomes[currentBiome].element
                });
            }

            // Trafik Ma≈üƒ±nƒ± Yaratmaq (Sad…ôc…ô sol v…ô saƒü zolaqda)
            if (Math.random() < 0.015) { 
                let isLeftLane = Math.random() < 0.5;
                trafficCars.push({
                    x: isLeftLane ? 125 : 325, // Bizim ma≈üƒ±n 225-d…ôdir
                    y: -150,
                    color: ["#95a5a6", "#e67e22", "#9b59b6", "#1abc9c", "#ffffff"][Math.floor(Math.random() * 5)],
                    speed: 2 + Math.random() * 1.5
                });
            }

            // H…ôr…ôk…ôtl…ôr
            if (!isBraking) {
                car.y -= gameSpeed;
                linesOffset += gameSpeed;
                totalDistance += gameSpeed;
                if (linesOffset > 100) linesOffset = 0;

                // M…ônz…ôr…ô obyektl…ôrini h…ôr…ôk…ôt etdir
                sceneryObjects.forEach(obj => obj.y += gameSpeed);
            }

            // M…ônz…ôr…ô D…ôyi≈üm…ôsi (H…ôr 3000 xal m…ôsaf…ôd…ô)
            if (totalDistance > 3000) {
                totalDistance = 0;
                currentBiome++;
                if (currentBiome >= biomes.length) currentBiome = 0; // Ba≈üa qayƒ±t
                biomeTextUI.innerText = "M…ônz…ôr…ô: " + biomes[currentBiome].name;
            }

            // Trafik ma≈üƒ±nlarƒ±nƒ±n h…ôr…ôk…ôti
            for (let i = 0; i < trafficCars.length; i++) {
                let tc = trafficCars[i];
                tc.y += tc.speed;
                if (!isBraking) tc.y += gameSpeed;
            }

            // Ekrandan √ßƒ±xanlarƒ± yadda≈üdan silirik (oyun donmasƒ±n)
            trafficCars = trafficCars.filter(tc => tc.y < 700);
            sceneryObjects = sceneryObjects.filter(obj => obj.y < 700);

            // Qazanc/C…ôrim…ô yoxlanƒ±≈üƒ±
            if (car.y < 150 && car.y > 140) {
                if (trafficLight.state === "red") {
                    balance -= 20; balanceUI.innerText = balance;
                    showMessage("-20 ‚Çº (C…ôrim…ô!)", "#ff3333");
                    car.y = 430;
                }
            }
            if (car.y < -100) {
                if(trafficLight.state === "green") {
                    balance += 10; balanceUI.innerText = balance;
                    showMessage("+10 ‚Çº (Uƒüurlu!)", "#00ff88");
                }
                car.y = 430; 
            }
            if (balance <= 0) {
                alert("Bakiy…ôniz sƒ±fƒ±rlandƒ±!");
                balance = 100; balanceUI.innerText = balance; car.y = 430; gamePaused = true;
            }
        }

        function gameLoop() {
            update(); draw(); requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>