<!DOCTYPE html>
<html lang="az" id="htmlTag">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Premium Drive - Tam G…ôlir Sistemi</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
      { "imports": { "@google/generative-ai": "https://esm.run/@google/generative-ai" } }
    </script>
    <style>
        body { user-select: none; -webkit-user-select: none; touch-action: none; overflow: hidden; background-color: #020617; } 
        .hidden { display: none !important; }
        .rtl { direction: rtl; font-family: 'Arial', sans-serif; }
        
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .neon-cyan { text-shadow: 0 0 10px rgba(34, 211, 238, 0.8); }
        .neon-emerald { text-shadow: 0 0 10px rgba(16, 185, 129, 0.8); }
        .neon-rose { text-shadow: 0 0 10px rgba(244, 63, 94, 0.8); }
        .neon-box-cyan { box-shadow: 0 0 20px rgba(34, 211, 238, 0.15); }
        .brake-shadow { box-shadow: 0 0 40px rgba(225, 29, 72, 0.6); }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(34,211,238,0.3); border-radius: 10px; }
    </style>
</head>
<body class="text-white h-screen flex flex-col font-sans relative transition-all duration-300">

    <div id="loginScreen" class="h-screen flex items-center justify-center p-6 z-50 absolute inset-0 bg-[#020617]">
        <div class="glass-panel p-10 rounded-[32px] w-full max-w-sm text-center relative overflow-hidden">
            <div class="absolute -top-10 -left-10 w-32 h-32 bg-cyan-500/20 rounded-full blur-[40px]"></div>
            
            <h1 class="text-3xl font-black text-white italic mb-2 tracking-tighter neon-cyan relative z-10">PREMIUM DRIVE</h1>
            <p class="text-slate-400 text-sm mb-8 relative z-10"><span id="lbl_loginBalance">Balans:</span> <span id="loginBalanceText" class="font-bold text-cyan-400 neon-cyan">0.30 AZN</span></p>
            
            <button id="loginBtn" class="w-full py-4 bg-cyan-500/20 border border-cyan-500/50 text-cyan-300 rounded-[24px] font-bold uppercase tracking-widest shadow-[0_0_15px_rgba(34,211,238,0.2)] active:scale-95 transition-all relative z-10">
                Oyuna Ba≈üla
            </button>
            <button id="loginTopupBtn" class="w-full mt-4 py-4 glass-panel rounded-[24px] text-white font-bold uppercase tracking-widest active:scale-95 transition-all relative z-10">
                Balansƒ± Artƒ±r
            </button>
        </div>
    </div>

    <div id="gameScreen" class="hidden h-screen flex flex-col relative overflow-hidden bg-[#020617]">
        <div class="p-4 flex justify-between items-center z-30 shrink-0">
            <div class="flex gap-2">
                <div class="glass-panel p-2 px-4 rounded-[20px] transition-all" id="balanceBox">
                    <p id="lbl_hudBalance" class="text-[9px] font-black text-cyan-400 uppercase tracking-[2px] mb-0.5 opacity-80">Balans</p>
                    <p id="balanceText" class="text-base font-black neon-cyan">0.30 AZN</p>
                </div>
                <div class="glass-panel p-2 px-4 rounded-[20px]">
                    <p id="lbl_hudDistance" class="text-[9px] font-black text-emerald-400 uppercase tracking-[2px] mb-0.5 opacity-80">M…ôsaf…ô</p>
                    <p id="scoreText" class="text-base font-black neon-emerald">0 M</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button id="withdrawBtn" class="w-12 h-12 bg-cyan-500/20 border border-cyan-500/50 text-cyan-400 rounded-[20px] flex items-center justify-center text-xl shadow-[0_0_15px_rgba(34,211,238,0.2)] active:scale-95 transition-all">üí∏</button>
                <button id="garageBtn" class="w-12 h-12 bg-indigo-500/20 border border-indigo-500/50 text-indigo-400 rounded-[20px] flex items-center justify-center text-xl shadow-[0_0_15px_rgba(99,102,241,0.2)] active:scale-95 transition-all">üõí</button>
                <button id="topupBtn" class="w-12 h-12 bg-[#FFDD00]/20 border border-[#FFDD00]/50 text-[#FFDD00] rounded-[20px] flex items-center justify-center text-xl shadow-[0_0_15px_rgba(255,221,0,0.2)] active:scale-95 transition-all">‚òï</button>
            </div>
        </div>

        <div class="px-4 z-30 mb-2 shrink-0">
            <div class="glass-panel border-blue-500/30 rounded-[20px] p-3 text-xs text-blue-100 flex items-center gap-3">
                <div class="w-7 h-7 rounded-full bg-blue-500/20 flex items-center justify-center border border-blue-500/40 shadow-[0_0_10px_rgba(59,130,246,0.5)] shrink-0"><span id="aiIcon" class="text-[10px]">ü§ñ</span></div>
                <span id="aiTipText" class="truncate w-full italic font-light">S√ºni intellekt m…ôsl…ôh…ôti y√ºkl…ônir...</span>
            </div>
        </div>

        <div class="flex-1 w-full max-w-[400px] mx-auto relative glass-panel neon-box-cyan rounded-[40px] overflow-hidden z-10 flex shrink">
            <canvas id="gameCanvas" width="400" height="600" class="w-full h-full object-contain bg-[#0f172a]"></canvas>
            <div class="absolute inset-0 flex">
                <div id="laneLeft" class="flex-1 active:bg-white/5 cursor-pointer"></div>
                <div id="laneRight" class="flex-1 active:bg-white/5 cursor-pointer"></div>
            </div>
            <div id="gameOverScreen" class="hidden absolute inset-0 bg-[#020617]/90 backdrop-blur-xl flex-col items-center justify-center p-8 text-center z-40">
                <div class="w-20 h-20 rounded-full bg-rose-500/20 flex items-center justify-center mb-4 blur-[2px] mx-auto"><span class="text-4xl">‚ö†Ô∏è</span></div>
                <h2 id="gameOverTitle" class="text-3xl font-black text-rose-500 mb-2 neon-rose tracking-wider">GAME OVER</h2>
                <p class="text-slate-400 text-sm mb-6">M…ôsaf…ô: <span id="finalScore" class="font-bold text-white">0</span> M</p>
                <button id="restartBtn" class="w-full py-4 bg-cyan-500/20 border border-cyan-500/50 text-cyan-300 rounded-[24px] font-bold uppercase tracking-widest shadow-[0_0_15px_rgba(34,211,238,0.2)] mb-4 active:scale-95 transition-all">YENƒ∞D∆èN BA≈ûLA</button>
            </div>
        </div>

        <div class="w-full max-w-[400px] mx-auto p-4 pb-6 shrink-0 z-20">
            <button id="brakeBtn" class="w-full py-6 rounded-[32px] text-3xl font-black tracking-widest transition-all bg-rose-600 border-4 border-rose-800 text-white brake-shadow active:bg-rose-500 active:scale-95 touch-manipulation">TORMOZ</button>
        </div>
    </div>

    <div id="topUpModal" class="hidden absolute inset-0 bg-[#020617]/90 backdrop-blur-2xl flex items-center justify-center p-6 z-[100] overflow-y-auto">
        <div class="glass-panel p-6 rounded-[40px] text-center w-full max-w-md relative overflow-hidden my-auto">
            <div class="absolute -top-20 -right-20 w-40 h-40 bg-[#FFDD00]/20 rounded-full blur-[50px]"></div>
            <h2 class="text-2xl font-black mb-4 neon-emerald relative z-10">Balansƒ± Artƒ±r</h2>
            <div class="text-slate-300 text-xs mb-6 relative z-10 space-y-3 text-left bg-[#0f172a]/80 p-4 rounded-[20px] border border-white/5 shadow-inner">
                <p class="flex items-start gap-2">
                    <span class="text-emerald-400 mt-0.5">‚úî</span>
                    <span><a href="https://buymeacoffee.com/surwin" target="_blank" class="text-[#FFDD00] underline font-bold">buymeacoffee.com/surwin</a> linkin…ô daxil olaraq <b>minimum 2 USD</b> √∂d…ôni≈ü etdikd…ô balans artacaq.</span>
                </p>
            </div>
            <button id="buyMeCoffeeBtn" class="w-full py-4 bg-[#FFDD00] text-black rounded-[24px] font-black shadow-[0_0_20px_rgba(255,221,0,0.3)] mb-4 active:scale-95 transition-all relative z-10 flex items-center justify-center gap-3 text-lg">‚òï √ñd…ôni≈ü Et</button>
            <button id="verifyPaymentBtn" class="w-full py-3 bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 rounded-[24px] font-bold mb-4 active:scale-95 transition-all relative z-10 text-sm">üîÑ √ñd…ôni≈üi Yoxla</button>
            <button id="closeTopUpBtn" class="text-slate-400 text-[12px] font-bold uppercase tracking-widest">Baƒüla</button>
        </div>
    </div>

    <div id="withdrawModal" class="hidden absolute inset-0 bg-[#020617]/90 backdrop-blur-2xl flex items-center justify-center p-6 z-[100]">
        <div class="glass-panel p-8 rounded-[40px] text-center w-full max-w-sm relative overflow-hidden">
            <h2 class="text-2xl font-black mb-2 neon-cyan relative z-10">Naƒüdla≈üdƒ±r</h2>
            <p id="withdrawBalanceDisplay" class="text-2xl font-black text-cyan-400 neon-cyan mb-6">0.00 AZN</p>
            <form id="withdrawForm" action="#" method="POST" class="flex flex-col gap-3 relative z-10">
                <input type="text" name="Ad_Soyad" placeholder="Ad v…ô Soyad" required class="w-full p-4 rounded-2xl bg-[#020617] border border-slate-700 text-white outline-none">
                <input type="text" name="Kart_Nomresi" placeholder="Kart N√∂mr…ôsi" required class="w-full p-4 rounded-2xl bg-[#020617] border border-slate-700 text-white outline-none">
                <p id="withdrawWarning" class="text-rose-500 text-xs font-bold hidden">Minimum 30 AZN t…ôl…ôb olunur.</p>
                <button type="submit" id="submitWithdrawBtn" class="w-full py-4 bg-cyan-500/20 border border-cyan-500/50 text-cyan-400 rounded-[24px] font-bold uppercase">Sorƒüu G√∂nd…ôr</button>
            </form>
            <button id="closeWithdrawBtn" class="text-slate-400 text-[12px] font-bold uppercase mt-6">Geri</button>
        </div>
    </div>

    <div id="garageModal" class="hidden absolute inset-0 bg-[#020617]/90 backdrop-blur-2xl flex flex-col items-center justify-center p-6 z-[100]">
        <div class="glass-panel p-6 rounded-[32px] w-full max-w-sm relative overflow-hidden flex flex-col max-h-[90%]">
            <h2 class="text-2xl font-black neon-cyan italic mb-4">QARAJ</h2>
            <div id="garageList" class="flex-1 overflow-y-auto pr-2 space-y-4 custom-scrollbar"></div>
            <button id="closeGarageBtn" class="w-full mt-6 py-4 glass-panel rounded-[20px] text-slate-300 font-bold uppercase">Baƒüla</button>
        </div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        const LANGUAGES = { az: { currency: 'AZN', rate: 1, tts: 'tr-TR' } };
        const CAR_SKINS = [
            { id: 'default', name: 'Neon Blue', color: '#0ea5e9', price: 0, owned: true },
            { id: 'sport', name: 'Sport Red', color: '#f43f5e', price: 5.00, owned: false },
            { id: 'taxi', name: 'City Taxi', color: '#facc15', price: 10.00, owned: false },
            { id: 'vip', name: 'VIP Stealth', color: '#0f172a', price: 25.00, owned: false }
        ];

        let activeSkinId = 'default';
        let currentLang = 'az';

        // AUDIO
        let audioCtx = null; let engineOsc = null; let engineGain = null;
        function initAudio() {
            if (audioCtx) return;
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            engineOsc = audioCtx.createOscillator(); engineGain = audioCtx.createGain();
            engineOsc.type = 'sawtooth'; engineOsc.frequency.setValueAtTime(40, audioCtx.currentTime);
            engineGain.gain.setValueAtTime(0.08, audioCtx.currentTime); 
            engineOsc.connect(engineGain); engineGain.connect(audioCtx.destination); engineOsc.start();
        }
        function playTone(freq, type, duration, vol = 0.1) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + duration);
        }

        // AI (Sizin a√ßarƒ±nƒ±zƒ± bura qoyun)
        const API_KEY = "Sƒ∞Zƒ∞N_API_A√áARINIZ"; 
        const genAI = new GoogleGenerativeAI(API_KEY);
        async function getDrivingAdvice(scenario) {
            const aiTipEl = document.getElementById("aiTipText");
            try {
                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                const prompt = `S…ôn oyunda s…ôsli k√∂m…ôk√ßis…ôn. Ssenari: ${scenario}. ≈û…ôn v…ô maksimum 5 s√∂zl√ºk cavab ver. Dil: Az…ôrbaycanca.`;
                const result = await model.generateContent(prompt);
                const text = await result.response.text();
                aiTipEl.innerText = text;
            } catch (error) { aiTipEl.innerText = "Yola diqq…ôt et!"; }
        }

        // OYUN MEXANƒ∞ZMƒ∞ (ASANLA≈ûDIRILMI≈û)
        const LOGICAL_WIDTH = 400; const LOGICAL_HEIGHT = 600;
        const CAR_WIDTH = 48; const CAR_HEIGHT = 86; const PLAYER_Y = LOGICAL_HEIGHT - 130;
        const LANES = [100, 200, 300];

        let isGameRunning = false; let isBraking = false; let isGameOver = false;
        let balance = parseFloat(localStorage.getItem('premiumDriveBalance')) || 0.30;
        
        let score = 0; let trafficCars = []; let speedMultiplier = 1; let animatedPopups = []; 
        let gameState = { carX: LANES[1] - CAR_WIDTH / 2, targetX: LANES[1] - CAR_WIDTH / 2, linesOffset: 0 };
        let trafficLight = { active: false, y: -200, state: 'GREEN', timer: 0, passed: false };
        const canvas = document.getElementById('gameCanvas'); const ctx = canvas.getContext('2d');

        function updateUI() {
            localStorage.setItem('premiumDriveBalance', balance.toFixed(2));
            const formatted = `${balance.toFixed(2)} AZN`;
            document.getElementById('balanceText').innerText = formatted;
            document.getElementById('loginBalanceText').innerText = formatted;
            document.getElementById('withdrawBalanceDisplay').innerText = formatted;
            document.getElementById('scoreText').innerText = `${Math.floor(score)} M`;
            
            const submitBtn = document.getElementById('submitWithdrawBtn');
            const warning = document.getElementById('withdrawWarning');
            if (balance < 30) {
                submitBtn.disabled = true; submitBtn.classList.add('opacity-50'); warning.classList.remove('hidden');
            } else {
                submitBtn.disabled = false; submitBtn.classList.remove('opacity-50'); warning.classList.add('hidden');
            }
        }

        function spawnPopup(text, color, x, y) { animatedPopups.push({ text, color, x, y, alpha: 1, life: 60 }); }

        function startGame() {
            document.getElementById('loginScreen').classList.add('hidden'); 
            document.getElementById('gameScreen').classList.remove('hidden'); 
            document.getElementById('gameOverScreen').classList.add('hidden');
            initAudio(); isGameRunning = true; isGameOver = false; score = 0; 
            speedMultiplier = 1; trafficCars = []; animatedPopups = [];
            gameState.carX = LANES[1] - CAR_WIDTH / 2; gameState.targetX = LANES[1] - CAR_WIDTH / 2;
            updateUI(); requestAnimationFrame(gameLoop);
        }

        function gameOver() {
            isGameOver = true; document.getElementById('gameOverScreen').classList.remove('hidden'); 
            document.getElementById('finalScore').innerText = Math.floor(score);
        }

        function update() {
            if (!isGameRunning || isGameOver) return;
            const baseSpeed = isBraking ? 0 : 4.5 * speedMultiplier; // S√ºr…ôti bir az azaltdƒ±q

            if (!isBraking) { 
                score += 0.1 * speedMultiplier; 
                if(speedMultiplier < 1.4) speedMultiplier += 0.00005
