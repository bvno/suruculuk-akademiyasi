<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Avtomobil SÃ¼rÃ¼ÅŸ Simulyatoru</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: linear-gradient(to bottom, #e6f0fa, #ffffff);
      color: #222;
    }
    header {
      background: linear-gradient(to right, #2e7d32, #1976d2);
      color: white;
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    header h1 { font-size: 1.6rem; }
    #user-info { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
    main {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
    }
    section { margin: 25px 0; }
    .hidden { display: none !important; }
    button {
      background: #388e3c;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      transition: 0.25s;
    }
    button:hover { background: #2e7d32; }
    .deposit-btn { background: #0288d1; }
    .deposit-btn:hover { background: #0277bd; }
    input, button { margin: 8px 0; }
    #game-canvas {
      border: 2px solid #444;
      background: #555;
      display: block;
      margin: 15px auto;
      max-width: 100%;
    }
    #game-message { color: #d32f2f; font-weight: bold; margin: 10px 0; }
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: white;
      padding: 25px;
      border-radius: 10px;
      max-width: 90%;
      max-height: 85vh;
      overflow-y: auto;
    }
    .close { float: right; font-size: 2rem; cursor: pointer; }
    #chat-window {
      border: 1px solid #aaa;
      height: 180px;
      overflow-y: auto;
      padding: 10px;
      background: #f9f9f9;
      margin-bottom: 10px;
      border-radius: 6px;
    }
    #chat-input { width: 70%; padding: 10px; }
    .error { color: #d32f2f; }

    @media (max-width: 600px) {
      header { flex-direction: column; gap: 10px; text-align: center; }
      main { padding: 15px; }
    }
  </style>
</head>
<body>

<header>
  <h1>Avtomobil SÃ¼rÃ¼ÅŸ Simulyatoru</h1>
  <div id="user-info">
    <span id="username-display"></span>
    <span id="balance-display">Balans: 0.00 â‚¼</span>
    <button id="logout-btn" class="hidden">Ã‡Ä±xÄ±ÅŸ</button>
  </div>
</header>

<main>

  <!-- GiriÅŸ/Qeydiyyat -->
  <section id="auth-section">
    <h2>GiriÅŸ vÉ™ ya Qeydiyyat</h2>
    <input type="text"    id="username"     placeholder="Ä°stifadÉ™Ã§i adÄ±" required />
    <input type="password" id="password"     placeholder="ÅifrÉ™" required />
    <label><input type="checkbox" id="remember-me"> MÉ™ni xatÄ±rla</label><br>
    <button id="login-btn">GiriÅŸ</button>
    <button id="register-btn">Qeydiyyat</button>
    <p id="auth-error" class="error"></p>
  </section>

  <!-- Balans artÄ±rma -->
  <section id="deposit-section" class="hidden">
    <h2>Balans artÄ±rmaq</h2>
    <button class="deposit-btn" data-amount="5">+5 â‚¼</button>
    <button class="deposit-btn" data-amount="10">+10 â‚¼</button>
    <button class="deposit-btn" data-amount="20">+20 â‚¼</button>
  </section>

  <!-- Oyun -->
  <section id="game-section" class="hidden">
    <h2>Oyuna baÅŸla!</h2>
    <canvas id="game-canvas" width="800" height="600"></canvas>
    <br>
    <button id="start-game-btn">Oyuna baÅŸla (0.20 â‚¼)</button>
    <p id="game-message"></p>
    <p style="color:#555; font-size:0.9rem;">
      Bu sadÉ™cÉ™ simulyasiyadÄ±r. ÆylÉ™ncÉ™ Ã¼Ã§Ã¼n oynayÄ±n vÉ™ mÉ™suliyyÉ™tlÉ™ davranÄ±n.
    </p>
  </section>

  <!-- Qaydalar modal -->
  <div id="rules-modal" class="modal hidden">
    <div class="modal-content">
      <span class="close">Ã—</span>
      <h2>Qaydalar</h2>

      <h3>AzÉ™rbaycanca</h3>
      <ul>
        <li>Ä°darÉ™etmÉ™: Ox dÃ¼ymÉ™lÉ™ri (sol/saÄŸ â†’ dÃ¶nmÉ™, yuxarÄ± â†’ qaz, aÅŸaÄŸÄ± â†’ É™ylÉ™c)</li>
        <li>QÄ±rmÄ±zÄ± iÅŸÄ±qda dayanmaq mÃ¼tlÉ™qdir (cÉ™za: -1 â‚¼)</li>
        <li>ManeÉ™lÉ™rÉ™ dÉ™ymÉ™k qadaÄŸandÄ±r (-1 â‚¼)</li>
        <li>SÃ¼rÉ™t hÉ™ddi 60 km/saat (artÄ±q sÃ¼rÉ™t â†’ cÉ™za)</li>
        <li>UÄŸurlu seqment â†’ +0.50 â‚¼</li>
        <li>Oyun qiymÉ™ti: 0.20 â‚¼ / sessiya</li>
        <li>Sessiya: 60 saniyÉ™ vÉ™ ya ciddi pozuntu ilÉ™ bitir</li>
      </ul>

      <h3>English</h3>
      <ul>
        <li>Controls: Arrow keys (left/right = steer, up = accelerate, down = brake)</li>
        <li>Stop at red light (penalty -1 AZN)</li>
        <li>Avoid obstacles (-1 AZN on collision)</li>
        <li>Speed limit 60 km/h</li>
        <li>Successful segment â†’ +0.50 AZN</li>
        <li>Cost per game: 0.20 AZN</li>
        <li>Session: 60 seconds or major violation</li>
      </ul>
    </div>
  </div>

  <!-- Chat -->
  <section id="chat-section" class="hidden">
    <h2>DÉ™stÉ™k Ã‡atÄ± (Bot)</h2>
    <div id="chat-window"></div>
    <input type="text" id="chat-input" placeholder="Mesaj yaz..." />
    <button id="chat-send">GÃ¶ndÉ™r</button>
  </section>

  <footer style="text-align:center; margin:30px 0; color:#555;">
    <button id="rules-btn">QaydalarÄ± gÃ¶stÉ™r</button>
  </footer>

</main>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  LocalStorage ilÉ™ sadÉ™ user sistemi
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function getUsers() {
  return JSON.parse(localStorage.getItem('gameUsers') || '[]');
}

function saveUsers(users) {
  localStorage.setItem('gameUsers', JSON.stringify(users));
}

function getCurrentUser() {
  return localStorage.getItem('currentGameUser');
}

function setCurrentUser(name) {
  localStorage.setItem('currentGameUser', name);
}

function findUser(name) {
  return getUsers().find(u => u.username === name);
}

function login(name, pass, remember) {
  const user = findUser(name);
  if (user && user.password === pass) {
    if (remember) setCurrentUser(name);
    showLoggedInUI(user);
    return true;
  }
  return false;
}

function register(name, pass) {
  if (findUser(name)) return false;
  const users = getUsers();
  users.push({ username: name, password: pass, balance: 5.00 });
  saveUsers(users);
  return true;
}

function updateBalance(name, delta) {
  const users = getUsers();
  const user = users.find(u => u.username === name);
  if (user) {
    user.balance = Math.max(0, Number((user.balance + delta).toFixed(2)));
    saveUsers(users);
    document.getElementById('balance-display').textContent = `Balans: ${user.balance.toFixed(2)} â‚¼`;
  }
}

function showLoggedInUI(user) {
  document.getElementById('auth-section').classList.add('hidden');
  document.getElementById('deposit-section').classList.remove('hidden');
  document.getElementById('game-section').classList.remove('hidden');
  document.getElementById('chat-section').classList.remove('hidden');
  document.getElementById('username-display').textContent = `XoÅŸ gÉ™ldin, ${user.username}`;
  document.getElementById('logout-btn').classList.remove('hidden');
  document.getElementById('balance-display').textContent = `Balans: ${user.balance.toFixed(2)} â‚¼`;
}

function logout() {
  localStorage.removeItem('currentGameUser');
  location.reload();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  Event Listeners â€“ Auth
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

document.getElementById('login-btn').onclick = () => {
  const name = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value;
  const remember = document.getElementById('remember-me').checked;
  const errEl = document.getElementById('auth-error');

  if (!name || !pass) {
    errEl.textContent = "Ad vÉ™ ÅŸifrÉ™ daxil edin";
    return;
  }

  if (login(name, pass, remember)) {
    errEl.textContent = "";
  } else {
    errEl.textContent = "YanlÄ±ÅŸ ad vÉ™ ya ÅŸifrÉ™";
  }
};

document.getElementById('register-btn').onclick = () => {
  const name = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value;
  const errEl = document.getElementById('auth-error');

  if (!name || !pass) {
    errEl.textContent = "Ad vÉ™ ÅŸifrÉ™ daxil edin";
    return;
  }

  if (register(name, pass)) {
    errEl.textContent = "Qeydiyyat uÄŸurlu! Ä°ndi giriÅŸ edin.";
  } else {
    errEl.textContent = "Bu ad artÄ±q mÃ¶vcuddur";
  }
};

document.getElementById('logout-btn').onclick = logout;

// Auto-login
window.addEventListener('load', () => {
  const name = getCurrentUser();
  if (name) {
    const user = findUser(name);
    if (user) showLoggedInUI(user);
  }
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  Deposit
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

document.querySelectorAll('.deposit-btn').forEach(btn => {
  btn.onclick = () => {
    const amt = Number(btn.dataset.amount);
    const name = getCurrentUser();
    if (name) updateBalance(name, amt);
  };
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  Qaydalar modal
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const rulesModal = document.getElementById('rules-modal');
document.getElementById('rules-btn').onclick = () => rulesModal.classList.remove('hidden');
document.querySelector('.close').onclick = () => rulesModal.classList.add('hidden');
rulesModal.onclick = e => { if (e.target === rulesModal) rulesModal.classList.add('hidden'); };

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  SadÉ™ motivasiya botu
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

let chatTimer;
const messages = [
  "Hey, hazÄ±rlaÅŸsan yaxÅŸÄ± olar â€“ daha Ã§ox qazanmaq istÉ™yirsÉ™n? ğŸš—ğŸ’¨",
  "Ã‡ox gÃ¶zÉ™l sÃ¼rÃ¼rsÉ™n! BelÉ™ davam et, balans artacaq! ğŸ”¥",
  "QaydalarÄ± unutma â€“ qÄ±rmÄ±zÄ± iÅŸÄ±qda dayanmaÄŸÄ± sevirÉ™m ğŸ˜‰"
];

function addChatMsg(from, text) {
  const div = document.createElement('div');
  div.innerHTML = `<strong>${from}:</strong> ${text}`;
  document.getElementById('chat-window').appendChild(div);
  div.scrollIntoView();
}

function botSay() {
  const msg = messages[Math.floor(Math.random()*messages.length)];
  addChatMsg("Bot", msg);
}

document.getElementById('chat-send').onclick = () => {
  const input = document.getElementById('chat-input');
  const txt = input.value.trim();
  if (!txt) return;
  addChatMsg("SÉ™n", txt);
  input.value = "";

  setTimeout(() => {
    addChatMsg("Bot", "TÉ™ÅŸÉ™kkÃ¼r! TÉ™hlÃ¼kÉ™siz sÃ¼rÃ¼ÅŸÉ™ davam et, qazancÄ±nÄ± artÄ±r ğŸ˜Š");
  }, 1200);

  clearTimeout(chatTimer);
  chatTimer = setTimeout(botSay, 35000);
};

// Ä°lk mesaj
setTimeout(() => {
  if (document.getElementById('chat-section').classList.contains('hidden') === false) {
    botSay();
  }
}, 8000);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  OYUN â€“ Canvas
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');
let gameActive = false;
let car = { x: 400, y: 550, w: 36, h: 60, speed: 2, maxSpeed: 5 };
let keys = {};
let obstacles = [];
let light = { color: 'green', timer: 5000, y: 120 };
let timeLeft = 60000;

window.addEventListener('keydown', e => keys[e.key] = true);
window.addEventListener('keyup',   e => keys[e.key] = false);

function startGame() {
  const name = getCurrentUser();
  const bal = findUser(name)?.balance || 0;

  if (bal < 0.20) {
    document.getElementById('game-message').textContent = "Balans kifayÉ™t qÉ™dÉ™r deyil. ZÉ™hmÉ™t olmasa balans artÄ±rÄ±n.";
    return;
  }

  updateBalance(name, -0.20);
  gameActive = true;
  car.x = 400; car.y = 550; car.speed = 2;
  obstacles = [];
  light.color = 'green'; light.timer = 5000;
  timeLeft = 60000;
  document.getElementById('game-message').textContent = "";
  document.getElementById('start-game-btn').disabled = true;

  setInterval(() => {
    if (gameActive) {
      obstacles.push({
        x: Math.random() * (canvas.width - 40) + 20,
        y: -40,
        w: 40, h: 40
      });
    }
  }, 1800);

  loop();
}

function loop() {
  if (!gameActive) return;

  ctx.fillStyle = "#444";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // yol xÉ™tlÉ™ri
  ctx.fillStyle = "white";
  for (let i = 0; i < canvas.height; i += 60) {
    ctx.fillRect(canvas.width/2 - 6, i + (Date.now()/20 % 60), 12, 30);
  }

  // idarÉ™etmÉ™
  if (keys['ArrowLeft'])  car.x -= 3.5;
  if (keys['ArrowRight']) car.x += 3.5;
  if (keys['ArrowUp'])    car.speed = Math.min(car.speed + 0.08, car.maxSpeed);
  if (keys['ArrowDown'])  car.speed = Math.max(car.speed - 0.12, 0.5);

  car.y -= car.speed;
  if (car.y < -car.h) {
    car.y = canvas.height;
    updateBalance(getCurrentUser(), 0.50);
    addChatMsg("Bot", "Æla seqment! +0.50 â‚¼ É™lavÉ™ olundu ğŸš€");
  }

  car.x = Math.max(car.w/2, Math.min(canvas.width - car.w/2, car.x));

  // maÅŸÄ±n
  ctx.fillStyle = "#e53935";
  ctx.fillRect(car.x - car.w/2, car.y, car.w, car.h);

  // iÅŸÄ±qfor
  light.timer -= 16.7;
  if (light.timer <= 0) {
    if (light.color === 'green') light.color = 'yellow';
    else if (light.color === 'yellow') light.color = light.prev === 'green' ? 'red' : 'green';
    else light.color = 'yellow';
    light.prev = light.color;
    light.timer = 5000;
  }

  ctx.fillStyle = light.color;
  ctx.fillRect(canvas.width/2 - 15, light.y, 30, 30);

  // qÄ±rmÄ±zÄ± pozuntusu
  if (light.color === 'red' && car.y < light.y + 80 && car.y + car.h > light.y - 20) {
    penalty(1, "QÄ±rmÄ±zÄ± iÅŸÄ±qda keÃ§din!");
    return;
  }

  // maneÉ™lÉ™r
  obstacles.forEach((o, i) => {
    o.y += car.speed + 1.2;
    ctx.fillStyle = "#000";
    ctx.fillRect(o.x - o.w/2, o.y, o.w, o.h);

    if (Math.abs(o.x - car.x) < (o.w + car.w)/2 &&
        Math.abs(o.y - (car.y + car.h/2)) < (o.h + car.h)/2) {
      penalty(1, "ManeÉ™yÉ™ dÉ™ydin!");
      return;
    }

    if (o.y > canvas.height + 50) obstacles.splice(i,1);
  });

  // sÃ¼rÉ™t hÉ™ddi
  if (car.speed > 4.2) {
    penalty(1, "SÃ¼rÉ™t hÉ™ddini aÅŸdÄ±n!");
    return;
  }

  timeLeft -= 16.7;
  if (timeLeft <= 0) {
    gameActive = false;
    document.getElementById('start-game-btn').disabled = false;
    document.getElementById('game-message').textContent = "Vaxt bitdi! YenidÉ™n cÉ™hd et.";
  }

  requestAnimationFrame(loop);
}

function penalty(amt, msg) {
  updateBalance(getCurrentUser(), -amt);
  document.getElementById('game-message').textContent = `${msg} -${amt} â‚¼`;
  gameActive = false;
  document.getElementById('start-game-btn').disabled = false;
  addChatMsg("Bot", "DiqqÉ™t! Pozuntu oldu. Daha diqqÉ™tli ol ğŸ˜‰");
}

document.getElementById('start-game-btn').onclick = startGame;

</script>
</body>
</html>
