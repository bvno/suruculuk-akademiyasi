<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S√ºr√ºc√ºl√ºk Akademiyasƒ± - SIFIRDAN YEKUN</title>
    <style>
        body { background-color: #0b0b18; color: #ffffff; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        
        /* AUTH SCREEN */
        #auth-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, #1a1a2e, #0b0b18); display: flex; justify-content: center; align-items: center; z-index: 5000; }
        .auth-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); padding: 40px; border-radius: 25px; border: 1px solid #00ff88; width: 330px; text-align: center; box-shadow: 0 0 40px rgba(0, 255, 136, 0.15); }
        .auth-input { width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 10px; border: 1px solid #333; background: rgba(0,0,0,0.5); color: white; outline: none; box-sizing: border-box; }
        .auth-btn { width: 100%; padding: 12px; background: #00ff88; color: #000; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .auth-btn:hover { background: #00cc6a; transform: translateY(-2px); }

        /* GAME LAYOUT */
        #game-interface { display: none; flex-direction: column; align-items: center; width: 100%; position: relative; }
        .top-header { position: absolute; top: -100px; width: 520px; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.8); padding: 15px 20px; border-radius: 20px; border: 1px solid #00ff88; box-sizing: border-box; }
        .balance-val { color: #00ff88; font-size: 24px; font-weight: bold; }
        .btn-group button { background: #16213e; color: #fff; border: 1px solid #00ff88; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 13px; margin-left: 5px; font-weight: bold; }

        /* CANVAS AREA */
        canvas { background-color: #2ecc71; border: 5px solid #1a1a2e; border-radius: 20px; box-shadow: 0 15px 50px rgba(0,0,0,0.8); transition: background-color 2.5s ease; }
        .game-controls { margin-top: 25px; }
        .brake-trigger { background: linear-gradient(145deg, #ff4b2b, #ff416c); color: white; padding: 20px 80px; border-radius: 60px; border: 3px solid white; font-weight: bold; cursor: pointer; font-size: 24px; box-shadow: 0 8px 25px rgba(255,0,0,0.5); text-transform: uppercase; }

        /* MODALS */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 6000; justify-content: center; align-items: center; }
        .modal-body { background: #16213e; border: 2px solid #00ff88; padding: 30px; border-radius: 25px; width: 400px; max-height: 85vh; overflow-y: auto; }
        .close-modal { background: #ff4d4d; color: white; border: none; padding: 12px; width: 100%; border-radius: 10px; cursor: pointer; margin-top: 20px; font-weight: bold; }

        /* GARAGE ITEMS */
        .garage-card { background: #0f0f1e; border: 1px solid #333; border-radius: 15px; padding: 15px; margin-bottom: 15px; display: flex; align-items: center; }
        .car-img { width: 50px; height: 90px; border-radius: 5px; border: 2px solid white; margin-right: 20px; }
        .buy-action { background: #00ff88; color: #000; border: none; padding: 10px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-left: auto; }

        /* CHAT */
        .chat-container { position: fixed; bottom: 25px; right: 25px; z-index: 100; }
        #chat-window { display: none; width: 300px; height: 380px; background: #1a1a2e; border: 1px solid #00ff88; border-radius: 20px; flex-direction: column; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        #chat-logs { flex: 1; padding: 15px; overflow-y: auto; font-size: 14px; }
        .bot-msg { color: #00ff88; margin-bottom: 10px; background: rgba(0,255,136,0.1); padding: 8px; border-radius: 8px; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-card">
            <h2 id="auth-header" style="color:#00ff88; margin-top:0;">QEYDƒ∞YYAT</h2>
            <input type="text" id="user-in" class="auth-input" placeholder="ƒ∞stifad…ô√ßi adƒ±">
            <input type="password" id="pass-in" class="auth-input" placeholder="≈ûifr…ô">
            <button class="auth-btn" onclick="processAuth()" id="auth-main-btn">HESAB YARAT</button>
            <p onclick="switchAuth()" id="switch-msg" style="cursor:pointer; margin-top:20px; font-size:14px; color:#aaa;">Hesabƒ±n var? <b style="color:#00ff88">Giri≈ü et</b></p>
        </div>
    </div>

    <div id="game-interface">
        <div class="top-header">
            <div>
                <span style="font-size:12px; color:#aaa;">S√ºr√ºc√º: <b id="active-user">...</b></span><br>
                <span class="balance-val"><span id="user-bal">100.00</span> ‚Çº</span>
            </div>
            <div class="btn-group">
                <button onclick="manageModal('garageBox', true)" style="color:#f1c40f; border-color:#f1c40f;">üõí QARAJ</button>
                <button onclick="manageModal('depBox', true)">üí∞ BAKƒ∞Y∆è</button>
                <button onclick="manageModal('rulesBox', true)">‚ÑπÔ∏è HAQQINDA</button>
                <button onclick="location.reload()" style="color:#ff4d4d; border-color:#ff4d4d;">X</button>
            </div>
        </div>

        <canvas id="mainCanvas" width="500" height="520"></canvas>
        <div id="alert-msg" style="position:absolute; top:45%; font-size:32px; font-weight:bold; opacity:0; transition:0.4s; pointer-events:none;"></div>
        
        <div class="game-controls">
            <button class="brake-trigger" id="brakeKey">TORMOZ VER!</button>
        </div>
    </div>

    <div id="rulesBox" class="modal-overlay">
        <div class="modal-body">
            <h2 style="color:#00ff88; margin-top:0;">üìñ Oyunun ≈û…ôrtl…ôri</h2>
            <p>1. Ma≈üƒ±n dayanmadan ir…ôlil…ôyir. ƒ∞≈üƒ±qfora m√ºtl…ôq riay…ôt etm…ôlisiniz.</p>
            <p>2. üî¥ <b>Qƒ±rmƒ±zƒ± ƒ∞≈üƒ±q:</b> D√ºym…ôni basƒ±b saxlayaraq dayanƒ±n. Ke√ßs…ôniz <b>-0.20 ‚Çº</b> c…ôrim…ô.</p>
            <p>3. üü¢ <b>Ya≈üƒ±l ƒ∞≈üƒ±q:</b> Uƒüurlu ke√ßid zamanƒ± <b>+0.10 ‚Çº</b> balansƒ±nƒ±za …ôlav…ô olunur.</p>
            <p>4. <b>M…ônz…ôr…ô:</b> Me≈ü…ôd…ôn S…ôhraya, S…ôhradan Qarlƒ± yollara s…ôyah…ôt ed…ôc…ôksiniz.</p>
            <button class="close-modal" onclick="manageModal('rulesBox', false)">ANLADIM</button>
        </div>
    </div>

    <div id="depBox" class="modal-overlay">
        <div class="modal-body" style="text-align:center;">
            <h2 style="color:#00ff88;">üí∞ Bakiy…ô Y√ºkl…ô</h2>
            <p>Minimum y√ºkl…ôm…ô m…ôbl…ôƒüi: <b>5.00 ‚Çº</b></p>
            <input type="number" id="loadAmt" class="auth-input" placeholder="M…ôbl…ôƒü daxil edin" min="5" style="text-align:center; font-size:22px;">
            <button class="auth-btn" onclick="execDeposit()">Y√úKL∆èM∆èNƒ∞ TAMAMLA</button>
            <button class="close-modal" onclick="manageModal('depBox', false)">L∆èƒûV ET</button>
        </div>
    </div>

    <div id="garageBox" class="modal-overlay">
        <div class="modal-body">
            <h2 style="color:#00ff88; margin-top:0;">üõí Professional Qaraj</h2>
            <div id="carListUI"></div>
            <button class="close-modal" onclick="manageModal('garageBox', false)">BAƒûLA</button>
        </div>
    </div>

    <div class="chat-container">
        <div id="chat-window">
            <div style="background:#00ff88; color:#000; padding:12px; font-weight:bold;">CANLI D∆èST∆èK</div>
            <div id="chat-logs"></div>
            <div style="display:flex; border-top:1px solid #333;">
                <input type="text" id="chatMsgIn" style="flex:1; background:none; border:none; color:white; padding:12px; outline:none;" placeholder="Mesajƒ±nƒ±z...">
                <button onclick="pushChat()" style="background:#00ff88; border:none; padding:12px; font-weight:bold;">></button>
            </div>
        </div>
        <button onclick="toggleChatWindow()" style="width:55px; height:55px; background:#00ff88; border-radius:50%; border:none; font-size:26px; cursor:pointer; box-shadow: 0 5px 15px rgba(0,255,136,0.3);">üí¨</button>
    </div>

    <script>
        let isLogin = false;
        let activeUser = "";
        let bal = 100.00;
        let selectedCarColor = "#3498db";
        let paused = false;
        let biomeData = [
            {label: "Ya≈üƒ±l Me≈ü…ô", bg: "#2ecc71", accent: "#27ae60"},
            {label: "Sarƒ± S…ôhra", bg: "#f39c12", accent: "#d35400"},
            {label: "Qarlƒ± Yol", bg: "#ecf0f1", accent: "#bdc3c7"}
        ];
        let currentBiomeIdx = 0;

        // --- AUTH LOGIC ---
        function switchAuth() {
            isLogin = !isLogin;
            document.getElementById("auth-header").innerText = isLogin ? "Gƒ∞Rƒ∞≈û" : "QEYDƒ∞YYAT";
            document.getElementById("auth-main-btn").innerText = isLogin ? "DAXƒ∞L OL" : "HESAB YARAT";
            document.getElementById("switch-msg").innerHTML = isLogin ? "Hesabƒ±n yoxdur? <b style='color:#00ff88'>Qeydiyyatdan ke√ß</b>" : "Hesabƒ±n var? <b style='color:#00ff88'>Giri≈ü et</b>";
        }

        function processAuth() {
            const u = document.getElementById("user-in").value.trim();
            const p = document.getElementById("pass-in").value;
            if(u.length < 3) return alert("ƒ∞stifad…ô√ßi adƒ± √ßox qƒ±sadƒ±r!");

            if(isLogin) {
                if(localStorage.getItem("p_" + u) === p) {
                    activeUser = u;
                    bal = parseFloat(localStorage.getItem("b_" + u)) || 100.00;
                    launchGame();
                } else alert("M…ôlumatlar yanlƒ±≈üdƒ±r!");
            } else {
                if(localStorage.getItem("p_" + u)) return alert("Bu ad artƒ±q istifad…ô olunub!");
                localStorage.setItem("p_" + u, p);
                localStorage.setItem("b_" + u, 100.00);
                alert("Uƒüurla qeydiyyatdan ke√ßdiniz! ƒ∞ndi giri≈ü edin.");
                switchAuth();
            }
        }

        function launchGame() {
            document.getElementById("auth-screen").style.display = "none";
            document.getElementById("game-interface").style.display = "flex";
            document.getElementById("active-user").innerText = activeUser;
            refreshUI();
            runCoreEngine();
        }

        function refreshUI() {
            document.getElementById("user-bal").innerText = bal.toFixed(2);
            localStorage.setItem("b_" + activeUser, bal);
        }

        function execDeposit() {
            const a = parseFloat(document.getElementById("loadAmt").value);
            if(a >= 5) { bal += a; refreshUI(); alert(a + " AZN y√ºkl…ôndi!"); manageModal('depBox', false); }
            else alert("Minimum 5 AZN daxil edin!");
        }

        // --- CORE GAME ENGINE ---
        function runCoreEngine() {
            const canvas = document.getElementById("mainCanvas");
            const ctx = canvas.getContext("2d");
            const brakeKey = document.getElementById("brakeKey");
            let isStopping = false;
            let playerY = 400;
            let offsetLines = 0;
            let lightObj = { status: "green", count: 0 };
            let roadTrafic = [];
            let trees = [];
            let totalKm = 0;

            brakeKey.onmousedown = () => isStopping = true;
            brakeKey.onmouseup = () => isStopping = false;
            brakeKey.ontouchstart = (e) => { e.preventDefault(); isStopping = true; };
            brakeKey.ontouchend = () => isStopping = false;

            function renderVehicle(x, y, color, hero = false) {
                ctx.fillStyle = "#111"; // Wheels
                ctx.fillRect(x-4, y+10, 6, 18); ctx.fillRect(x+48, y+10, 6, 18);
                ctx.fillRect(x-4, y+62, 6, 18); ctx.fillRect(x+48, y+62, 6, 18);
                ctx.fillStyle = color; // Body
                ctx.fillRect(x, y, 50, 90);
                ctx.fillStyle = "rgba(0,0,0,0.4)"; // Glass
                ctx.fillRect(x+5, y+15, 40, 22);
                ctx.fillStyle = hero ? "yellow" : "white"; // Front lights
                ctx.fillRect(x+6, y+2, 12, 6); ctx.fillRect(x+32, y+2, 12, 6);
            }

            function cycle() {
                if(paused) return requestAnimationFrame(cycle);

                // LIGHT LOGIC
                lightObj.count++;
                if(lightObj.count > 160) lightObj.status = "red";
                if(lightObj.count > 340) { lightObj.status = "green"; lightObj.count = 0; }

                if(!isStopping) {
                    offsetLines += 5.5; if(offsetLines > 100) offsetLines = 0;
                    playerY -= 4; totalKm++;
                    roadTrafic.forEach(t => t.y += 2.8);
                    trees.forEach(tr => tr.y += 5.5);
                }

                if(Math.random() < 0.012) roadTrafic.push({x: Math.random() < 0.5 ? 125 : 325, y: -120, c: "#d35400"});
                if(Math.random() < 0.06) trees.push({x: Math.random() < 0.5 ? 35 : 445, y: -60, r: 15+Math.random()*20});

                if(totalKm > 2000) { totalKm = 0; currentBiomeIdx = (currentBiomeIdx + 1) % biomeData.length; }

                if(playerY < -100) {
                    if(lightObj.status === "red") { bal -= 0.20; flashMsg("-0.20 ‚Çº C…ôrim…ô!", "#ff416c"); }
                    else { bal += 0.10; flashMsg("+0.10 ‚Çº Qazanc!", "#00ff88"); }
                    refreshUI(); playerY = 400;
                }

                // DRAWING
                canvas.style.backgroundColor = biomeData[currentBiomeIdx].bg;
                ctx.clearRect(0,0,500,520);
                ctx.fillStyle = "#34495e"; ctx.fillRect(100,0,300,520); // Road
                
                trees.forEach(t => { ctx.fillStyle = biomeData[currentBiomeIdx].accent; ctx.beginPath(); ctx.arc(t.x, t.y, t.r, 0, 7); ctx.fill(); });

                ctx.fillStyle = "#fff"; // Lanes
                for(let i=0; i<10; i++) {
                    ctx.fillRect(196, i*100 + offsetLines - 100, 7, 45);
                    ctx.fillRect(296, i*100 + offsetLines - 100, 7, 45);
                }
                ctx.fillStyle = "#fff"; ctx.fillRect(100, 150, 300, 10); // Stop line

                // TRAFFIC LIGHT
                ctx.fillStyle = "#111"; ctx.fillRect(415, 60, 50, 110);
                ctx.fillStyle = lightObj.status === "red" ? "#ff0000" : "#400"; ctx.beginPath(); ctx.arc(440, 90, 14, 0, 7); ctx.fill();
                ctx.fillStyle = lightObj.status === "green" ? "#00ff00" : "#040"; ctx.beginPath(); ctx.arc(440, 140, 14, 0, 7); ctx.fill();

                roadTrafic.forEach(t => renderVehicle(t.x, t.y, t.c));
                renderVehicle(225, playerY, selectedCarColor, true);

                roadTrafic = roadTrafic.filter(t => t.y < 650);
                trees = trees.filter(tr => tr.y < 650);

                requestAnimationFrame(cycle);
            }
            cycle();
        }

        // --- GARAGE & MODALS ---
        let carCollection = [
            {n: "Mavi ≈ûahin", c: "#3498db", p: 0},
            {n: "Qƒ±rmƒ±zƒ± Canavar", c: "red", p: 20},
            {n: "Sarƒ± Fƒ±rtƒ±na", c: "yellow", p: 40},
            {n: "Qara C…ôngav…ôr", c: "#111", p: 60}
        ];
        function manageModal(id, open) { 
            document.getElementById(id).style.display = open ? "flex" : "none"; paused = open;
            if(id === 'garageBox' && open) {
                let h = "";
                carCollection.forEach((c, i) => {
                    h += `<div class="garage-card">
                        <div class="car-img" style="background:${c.c}"></div>
                        <div style="flex:1"><b>${c.n}</b><br><small>${c.p} ‚Çº</small></div>
                        <button class="buy-action" onclick="purchaseCar(${i})">SE√á/AL</button>
                    </div>`;
                });
                document.getElementById("carListUI").innerHTML = h;
            }
        }
        function purchaseCar(i) {
            let car = carCollection[i];
            if(bal >= car.p) { selectedCarColor = car.c; manageModal('garageBox', false); }
            else alert("Kifay…ôt q…ôd…ôr balansƒ±nƒ±z yoxdur!");
        }

        function flashMsg(t, c) {
            const m = document.getElementById("alert-msg"); m.innerText = t; m.style.color = c; m.style.opacity = 1;
            setTimeout(() => m.style.opacity = 0, 1500);
        }

        function toggleChatWindow() { const w = document.getElementById("chat-window"); w.style.display = w.style.display === "flex" ? "none" : "flex"; }
        function pushChat() {
            const i = document.getElementById("chatMsgIn"); if(!i.value) return;
            const l = document.getElementById("chat-logs");
            l.innerHTML += `<div style="text-align:right; margin-bottom:10px;">${i.value}</div>`;
            setTimeout(() => { l.innerHTML += `<div class="bot-msg"><b>D…ôst…ôk:</b> Salam! Bakiy…ô artƒ±rmaq √º√ß√ºn yuxarƒ±dakƒ± "BAKƒ∞Y∆è" d√ºym…ôsin…ô basƒ±n (min. 5 ‚Çº).</div>`; l.scrollTop = l.scrollHeight; }, 600);
            i.value = "";
        }
    </script>
</body>
</html>
