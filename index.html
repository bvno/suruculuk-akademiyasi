<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>üöó S√ºr√º≈ü Simulyatoru</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; touch-action: manipulation; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(180deg, #0f2027, #203a43, #2c5364);
      color: #e0f7fa;
      min-height: 100vh;
      overflow-x: hidden;
    }

    header {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(6px);
      padding: 10px 14px;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.95rem;
    }

    #username-display { font-weight: 600; color: #4fc3f7; }
    #balance-display  { font-weight: bold; color: #ffca28; }

    main {
      padding: 70px 10px 140px;
    }

    section { margin: 20px 0; }

    .hidden { display: none !important; }

    h2 { color: #80deea; margin-bottom: 12px; text-shadow: 0 1px 3px #000; }

    button {
      background: linear-gradient(145deg, #00b8d4, #0097a7);
      color: white;
      border: none;
      padding: 12px 22px;
      margin: 6px;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 0 #006064;
      transition: transform 0.08s;
      touch-action: manipulation;
    }

    button:active { transform: translateY(2px); box-shadow: 0 2px 0 #006064; }

    .deposit-btn {
      background: linear-gradient(145deg, #ffca28, #ffb300);
      box-shadow: 0 4px 0 #ff8f00;
    }

    input {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border-radius: 10px;
      border: 2px solid #4fc3f7;
      background: rgba(255,255,255,0.1);
      color: white;
      font-size: 1.05rem;
    }

    #game-container {
      position: relative;
      margin: 0 auto;
      max-width: 100%;
      aspect-ratio: 4 / 3;
      background: #111;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.7);
    }

    #game-canvas { width: 100%; height: 100%; display: block; }

    #start-game-btn {
      display: block;
      margin: 16px auto;
      padding: 16px 40px;
      font-size: 1.3rem;
      background: linear-gradient(145deg, #ff5252, #d32f2f);
      box-shadow: 0 6px 0 #b71c1c;
    }

    #controls {
      position: fixed;
      bottom: 20px; left: 0; right: 0;
      display: flex;
      justify-content: space-between;
      padding: 0 20px;
      pointer-events: none;
    }

    .ctrl-btn {
      width: 80px; height: 80px;
      background: rgba(255,255,255,0.15);
      border: 2px solid #4fc3f7;
      border-radius: 50%;
      font-size: 2.2rem;
      color: #e0f7fa;
      pointer-events: auto;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(4px);
    }

    .ctrl-btn:active { background: rgba(255,255,255,0.3); }

    #message {
      text-align: center;
      font-size: 1.1rem;
      margin: 12px 0;
      min-height: 1.4em;
      color: #ff8a65;
    }

    .modal {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.8);
      display: flex; align-items: center; justify-content: center;
      z-index: 200;
      padding: 20px;
    }

    .modal-content {
      background: #1e272e;
      padding: 24px;
      border-radius: 16px;
      max-width: 90%;
      max-height: 85vh;
      overflow-y: auto;
      color: #e0f7fa;
    }

    .close { float: right; font-size: 2.4rem; cursor: pointer; }

    #chat-window {
      background: rgba(0,0,0,0.4);
      border-radius: 12px;
      height: 160px;
      overflow-y: auto;
      padding: 12px;
      margin-bottom: 12px;
      font-size: 0.95rem;
    }

    @media (min-width: 768px) {
      main { max-width: 900px; margin: 80px auto 160px; }
      #game-container { max-width: 720px; }
      #controls { display: none; } /* PC-d…ô klaviatura istifad…ô olunacaq */
    }
  </style>
</head>
<body>

<header>
  <div id="username-display"></div>
  <div id="balance-display">Balans: 0.00 ‚Çº</div>
</header>

<main>

  <section id="auth-section">
    <h2>Giri≈ü / Qeydiyyat</h2>
    <input type="text" id="username" placeholder="Adƒ±n" autocomplete="off"/>
    <input type="password" id="password" placeholder="≈ûifr…ô" autocomplete="new-password"/>
    <label style="display:block; margin:10px 0;">
      <input type="checkbox" id="remember-me"/> M…ôni xatƒ±rla
    </label>
    <button id="login-btn">Giri≈ü</button>
    <button id="register-btn">Qeydiyyat</button>
    <p id="auth-error" style="color:#ff8a65; min-height:1.3em;"></p>
  </section>

  <section id="game-section" class="hidden">
    <div id="game-container">
      <canvas id="game-canvas"></canvas>
    </div>

    <div id="controls">
      <div class="ctrl-btn" id="btn-left">‚Üê</div>
      <div style="display:flex; flex-direction:column; gap:30px;">
        <div class="ctrl-btn" id="btn-up">‚Üë</div>
        <div class="ctrl-btn" id="btn-down">‚Üì</div>
      </div>
      <div class="ctrl-btn" id="btn-right">‚Üí</div>
    </div>

    <button id="start-game-btn">OYUNA BA≈ûLA (0.20 ‚Çº)</button>
    <div id="message"></div>
    <p style="text-align:center; font-size:0.85rem; color:#b0bec5; margin-top:8px;">
      Simulyasiyadƒ±r ‚Ä¢ ∆èyl…ônc…ô √º√ß√ºnd√ºr ‚Ä¢ M…ôsuliyy…ôtl…ô oynayƒ±n
    </p>
  </section>

  <!-- Qaydalar modal -->
  <div id="rules-modal" class="modal hidden">
    <div class="modal-content">
      <span class="close">√ó</span>
      <h2>Qaydalar (qƒ±sa)</h2>
      <ul style="line-height:1.6;">
        <li>‚Üê ‚Üí ‚Üë ‚Üì   ‚Üí d√∂nm…ô / qaz / …ôyl…ôc</li>
        <li>Qƒ±rmƒ±zƒ±da dayan (c…ôza ‚Äì1 ‚Çº)</li>
        <li>Mane…ôy…ô toxunma (‚Äì1 ‚Çº)</li>
        <li>S√ºr…ôt ‚â§ 60 km/s (artƒ±q ‚Üí c…ôza)</li>
        <li>H…ôr uƒüurlu ke√ßid +0.50 ‚Çº</li>
        <li>Oyun ‚Ä¢ 0.20 ‚Çº / c…ôhd ‚Ä¢ 60 saniy…ô</li>
      </ul>
    </div>
  </div>

</main>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  USER & BALANS (localStorage)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const ls = localStorage;
function getUsers()     { return JSON.parse(ls.getItem('gameUsers')||'[]'); }
function saveUsers(u)   { ls.setItem('gameUsers', JSON.stringify(u)); }
function currentUser()  { return ls.getItem('currentGameUser'); }
function setUser(n)     { ls.setItem('currentGameUser', n); }

function findUser(name) { return getUsers().find(u=>u.username===name); }

function login(name, pass, rem) {
  const u = findUser(name);
  if (u && u.password === pass) {
    if (rem) setUser(name);
    showGame(u);
    return true;
  }
  return false;
}

function register(name, pass) {
  if (findUser(name)) return false;
  const us = getUsers();
  us.push({username:name, password:pass, balance:5.00});
  saveUsers(us);
  return true;
}

function chBal(delta) {
  const name = currentUser();
  if (!name) return;
  const us = getUsers();
  const u = us.find(x=>x.username===name);
  if (u) {
    u.balance = Math.max(0, Number((u.balance + delta).toFixed(2)));
    saveUsers(us);
    document.getElementById('balance-display').textContent = `Balans: ${u.balance.toFixed(2)} ‚Çº`;
  }
}

function showGame(user) {
  document.getElementById('auth-section').classList.add('hidden');
  document.getElementById('game-section').classList.remove('hidden');
  document.getElementById('username-display').textContent = user.username;
  document.getElementById('balance-display').textContent = `Balans: ${user.balance.toFixed(2)} ‚Çº`;
}

// Auto-login
window.addEventListener('load', ()=>{
  const n = currentUser();
  if (n) {
    const u = findUser(n);
    if (u) showGame(u);
  }
});

// Auth buttons
document.getElementById('login-btn').onclick = ()=>{
  const n = document.getElementById('username').value.trim();
  const p = document.getElementById('password').value;
  const r = document.getElementById('remember-me').checked;
  const e = document.getElementById('auth-error');
  if (!n || !p) { e.textContent="Ad v…ô ≈üifr…ô yaz"; return; }
  e.textContent = login(n,p,r) ? "" : "Yanlƒ±≈ü ad/≈üifr…ô";
};

document.getElementById('register-btn').onclick = ()=>{
  const n = document.getElementById('username').value.trim();
  const p = document.getElementById('password').value;
  const e = document.getElementById('auth-error');
  if (!n || !p) { e.textContent="Ad v…ô ≈üifr…ô yaz"; return; }
  e.textContent = register(n,p) ? "Qeydiyyat tamam! Giri≈ü et." : "Bu ad artƒ±q var";
};

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  OYUN M∆èNTƒ∞Qƒ∞
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const cvs = document.getElementById('game-canvas');
const ctx = cvs.getContext('2d');
let w, h;

function resize() {
  w = cvs.clientWidth;
  h = cvs.clientHeight;
  cvs.width = w;
  cvs.height = h;
}
window.addEventListener('resize', resize);
resize();

let running = false;
let car = {x:0, y:0, w:44, h:80, speed:1.8, angle:0};
let keys = {};
let obstacles = [];
let light = {color:'green', timer:5000, y:0};
let timeLeft = 60000;
let lastTime = 0;

const touch = {
  left:false, right:false, up:false, down:false
};

['left','right','up','down'].forEach(dir=>{
  const btn = document.getElementById(`btn-${dir}`);
  if (!btn) return;
  btn.addEventListener('touchstart', e=>{ e.preventDefault(); touch[dir]=true; });
  btn.addEventListener('touchend',   e=>{ e.preventDefault(); touch[dir]=false; });
  // PC √º√ß√ºn d…ô olsun
  btn.addEventListener('mousedown', ()=> touch[dir]=true);
  btn.addEventListener('mouseup',   ()=> touch[dir]=false);
});

window.addEventListener('keydown', e=> keys[e.key]=true);
window.addEventListener('keyup',   e=> keys[e.key]=false);

function start() {
  const bal = findUser(currentUser())?.balance ?? 0;
  if (bal < 0.20) {
    document.getElementById('message').textContent = "Balans azdƒ±r ‚Ä¢ Artƒ±rƒ±n";
    return;
  }
  chBal(-0.20);
  running = true;
  car.x = w/2; car.y = h-100; car.speed = 1.8; car.angle = 0;
  obstacles = [];
  light.color = 'green'; light.timer = 5000; light.y = h*0.25;
  timeLeft = 60000;
  document.getElementById('message').textContent = "";
  document.getElementById('start-game-btn').textContent = "YENƒ∞ OYUN";
  lastTime = performance.now();
  requestAnimationFrame(loop);
}

function loop(now) {
  if (!running) return;
  const dt = now - lastTime;
  lastTime = now;

  ctx.fillStyle = "#0d1b2a";
  ctx.fillRect(0,0,w,h);

  // gradient yol
  const gr = ctx.createLinearGradient(0,0,0,h);
  gr.addColorStop(0,   "#1b263b");
  gr.addColorStop(0.5, "#415a77");
  gr.addColorStop(1,   "#1b263b");
  ctx.fillStyle = gr;
  ctx.fillRect(0,0,w,h);

  // yol x…ôtl…ôri (h…ôr…ôk…ôt effekti)
  ctx.fillStyle = "rgba(255,255,200,0.8)";
  const offset = (now/8) % 80;
  for (let i = -80; i < h+80; i += 80) {
    ctx.fillRect(w/2-8, i+offset, 16, 40);
  }

  // idar…ôetm…ô
  if (keys['ArrowLeft']  || touch.left)  car.angle -= 0.06;
  if (keys['ArrowRight'] || touch.right) car.angle += 0.06;
  if (keys['ArrowUp']    || touch.up)    car.speed = Math.min(car.speed + 0.12*dt/16, 5.8);
  if (keys['ArrowDown']  || touch.down)  car.speed = Math.max(car.speed - 0.18*dt/16, 0);

  car.x += Math.sin(car.angle) * car.speed * dt/5;
  car.y -= Math.cos(car.angle) * car.speed * dt/5;

  car.x = Math.max(30, Math.min(w-30, car.x));
  if (car.y < -100) {
    car.y = h + 50;
    chBal(0.50);
    document.getElementById('message').textContent = "+0.50 ‚Çº …ôlav…ô olundu!";
    setTimeout(()=>document.getElementById('message').textContent="", 1800);
  }

  // ma≈üƒ±n (sad…ô trapezium)
  ctx.save();
  ctx.translate(car.x, car.y);
  ctx.rotate(car.angle);
  ctx.fillStyle = "#ff1744";
  ctx.beginPath();
  ctx.moveTo(-22, -40);
  ctx.lineTo( 22, -40);
  ctx.lineTo( 28,  40);
  ctx.lineTo(-28,  40);
  ctx.closePath();
  ctx.fill();
  ctx.restore();

  // i≈üƒ±qfor
  light.timer -= dt;
  if (light.timer <= 0) {
    if      (light.color==='green')  light.color='yellow';
    else if (light.color==='yellow') light.color = light.prev==='green'?'red':'green';
    else                             light.color='yellow';
    light.prev = light.color;
    light.timer = 4800 + Math.random()*800;
  }

  ctx.fillStyle = light.color;
  ctx.fillRect(w/2-20, light.y-20, 40, 40);

  // qƒ±rmƒ±zƒ± pozuntusu
  if (light.color==='red' && Math.abs(car.y - light.y) < 100) {
    penalty(1, "Qƒ±rmƒ±zƒ± i≈üƒ±q pozuntusu!");
    return;
  }

  // mane…ôl…ôr
  if (Math.random() < 0.025*dt/16) {
    obstacles.push({x:30+Math.random()*(w-60), y:-60, size:48});
  }

  obstacles = obstacles.filter(o=>{
    o.y += car.speed*1.4 + 1.2;
    ctx.fillStyle = "#212121";
    ctx.fillRect(o.x-o.size/2, o.y-o.size/2, o.size, o.size);

    const dx = o.x - car.x;
    const dy = o.y - car.y;
    if (Math.sqrt(dx*dx + dy*dy) < 60) {
      penalty(1, "Mane…ôy…ô d…ôydin!");
      return false;
    }
    return o.y < h+100;
  });

  // s√ºr…ôt h…ôddi
  if (car.speed > 5.4) {
    penalty(1, "√áox s√ºr…ôt!");
    return;
  }

  timeLeft -= dt;
  if (timeLeft <= 0) {
    running = false;
    document.getElementById('message').textContent = "Vaxt bitdi ‚Ä¢ Yenid…ôn c…ôhd et!";
  }

  requestAnimationFrame(loop);
}

function penalty(amt, txt) {
  chBal(-amt);
  document.getElementById('message').textContent = `${txt}  ‚Äì${amt} ‚Çº`;
  running = false;
  setTimeout(()=>document.getElementById('message').textContent="", 3200);
}

document.getElementById('start-game-btn').onclick = start;

// Qaydalar modal
const mod = document.getElementById('rules-modal');
document.getElementById('message').addEventListener('click', ()=>mod.classList.remove('hidden'));
document.querySelector('.close').onclick = ()=>mod.classList.add('hidden');
mod.onclick = e=> { if(e.target===mod) mod.classList.add('hidden'); };

</script>
</body>
</html>
