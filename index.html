function update() {
            if (!isGameRunning || isGameOver) return;
            
            // 1. Əsas sürət azaldıldı (oyun çox sürətli/maye olmasın deyə 5-dən 3.5-ə salındı)
            const baseSpeed = isBraking ? 0 : 3.5 * speedMultiplier; 

            // 2. Maksimum sürət və sürətlənmə azaldıldı
            if (!isBraking) { 
                score += 0.1 * speedMultiplier; 
                if(speedMultiplier < 1.2) speedMultiplier += 0.00005; // Əvvəl 1.5 və 0.0001 idi
            }

            gameState.linesOffset = (gameState.linesOffset + baseSpeed) % 80; 
            gameState.carX += (gameState.targetX - gameState.carX) * 0.15;

            if (!trafficLight.active && Math.random() < 0.003 && score > 50) { 
                trafficLight.active = true; trafficLight.y = -100; trafficLight.passed = false; trafficLight.timer = 300; trafficLight.state = 'GREEN'; 
            }
            
            if (trafficLight.active) {
                trafficLight.y += baseSpeed; trafficLight.timer--;
                if (trafficLight.timer === 200) trafficLight.state = 'YELLOW';
                if (trafficLight.timer === 140) trafficLight.state = 'RED';
                if (trafficLight.timer === 0) trafficLight.state = 'GREEN';

                if (trafficLight.y > PLAYER_Y + CAR_HEIGHT && !trafficLight.passed) {
                    trafficLight.passed = true;
                    // Qırmızı işıqda tormoz basılmasa cərimə edilir (Sənin qurduğun məntiq qorundu)
                    if (trafficLight.state === 'RED' && !isBraking) { 
                        balance -= 0.20; 
                        playFineSound(); 
                        spawnPopup("-0.20 AZN", "#f43f5e", gameState.carX + CAR_WIDTH/2, PLAYER_Y - 20); 
                        getDrivingAdvice("Qırmızı işıq! Cərimə."); 
                    } 
                    else if (trafficLight.state === 'GREEN') { 
                        balance += 0.50; 
                        playSuccessSound(); 
                        spawnPopup("+0.50 AZN", "#10b981", gameState.carX + CAR_WIDTH/2, PLAYER_Y - 20); 
                        getDrivingAdvice("Yaşıl işıq bonusu!"); 
                    }
                    updateUI(); if (balance <= 0) { balance = 0; gameOver(); }
                }
                if (trafficLight.y > LOGICAL_HEIGHT) trafficLight.active = false;
            }

            // 3. Qarşıdan gələn maşınların yaranma ehtimalı və sürəti azaldıldı (Çətinlik düşdü)
            if (Math.random() < 0.008 * speedMultiplier && !isBraking && !trafficLight.active) { // Əvvəl 0.02 idi
                const lane = LANES[Math.floor(Math.random() * LANES.length)];
                if (trafficCars.every(c => Math.abs(c.x - (lane - CAR_WIDTH/2)) > 10 || c.y > 150)) {
                    // Maşınların sürəti azaldıldı
                    trafficCars.push({ x: lane - CAR_WIDTH / 2, y: -100, speed: Math.random() * 1.5 + 1.5, color: '#f43f5e' }); 
                }
            }

            for (let i = trafficCars.length - 1; i >= 0; i--) {
                let car = trafficCars[i]; 
                car.y += baseSpeed + (isBraking ? car.speed * 2 : car.speed - 2); 
                if (gameState.carX < car.x + CAR_WIDTH - 5 && gameState.carX + CAR_WIDTH - 5 > car.x && PLAYER_Y < car.y + CAR_HEIGHT - 5 && PLAYER_Y + CAR_HEIGHT - 5 > car.y) {
                    balance -= 1.00; playCrashSound(); spawnPopup("-1.00 AZN", "#f43f5e", gameState.carX + CAR_WIDTH/2, PLAYER_Y); trafficCars.splice(i, 1); getDrivingAdvice("Qəza etdin!"); updateUI(); 
                    if (balance <= 0) { balance = 0; gameOver(); return; }
                } else if (car.y > LOGICAL_HEIGHT) { trafficCars.splice(i, 1); }
            }

            animatedPopups.forEach(p => { p.y -= 1.5; p.alpha -= 0.015; p.life--; }); animatedPopups = animatedPopups.filter(p => p.life > 0);
            if (engineGain && audioCtx) { engineOsc.frequency.setTargetAtTime(isBraking ? 30 : 40 * speedMultiplier, audioCtx.currentTime, 0.1); engineGain.gain.setTargetAtTime(isBraking ? 0.02 : Math.min(0.15, 0.08 * speedMultiplier), audioCtx.currentTime, 0.1); }
        }
